(function(){var n,e=[].indexOf||function(n){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===n)return e;return-1};n=angular.module("angularBootstrapNavTree",[]),n.directive("abnTree",["$timeout",function(n){return{restrict:"E",template:'<ul class="nav nav-list nav-pills nav-stacked abn-tree">\n  <li ng-repeat="row in tree_rows | filter:{visible:true} track by row.branch.uid" ng-animate="\'abn-tree-animate\'" ng-class="\'level-\' + {{ row.level }} + (row.branch.selected ? \' active\':\'\') + \' \' +row.classes.join(\' \')" class="abn-tree-row"><a ng-click="user_clicks_branch(row.branch)"><i ng-class="row.tree_icon" ng-click="row.branch.expanded = !row.branch.expanded" class="indented tree-icon"> </i><span class="indented tree-label" style="margin-left: 7px;">{{ row.label }} </span></a></li>\n</ul>',replace:!0,scope:{treeData:"=",onSelect:"&",initialSelection:"@",treeControl:"="},link:function(r,t,l){var i,a,c,u,o,s,d,h,_,f,g;if(i=function(n){console.log("ERROR:"+n)},null==l.iconExpand&&(l.iconExpand="icon-plus  glyphicon glyphicon-plus  fa fa-plus"),null==l.iconCollapse&&(l.iconCollapse="icon-minus glyphicon glyphicon-minus fa fa-minus"),null==l.iconLeaf&&(l.iconLeaf="icon-file  glyphicon glyphicon-file  fa fa-file"),null==l.expandLevel&&(l.expandLevel="3"),c=parseInt(l.expandLevel,10),!r.treeData)return void alert("no treeData defined for the tree!");if(null==r.treeData.length){if(null==treeData.label)return void alert("treeData should be an array of root branches");r.treeData=[treeData]}return o=function(n){var e,t,l,i,a,c;for(e=function(r,t){var l,i,a,c,u;if(n(r,t),null!=r.children){for(c=r.children,u=[],i=0,a=c.length;a>i;i++)l=c[i],u.push(e(l,t+1));return u}},a=r.treeData,c=[],l=0,i=a.length;i>l;l++)t=a[l],c.push(e(t,1));return c},f=null,_=function(e){if(!e)return null!=f&&(f.selected=!1),void(f=null);if(e!==f){if(null!=f&&(f.selected=!1),e.selected=!0,f=e,a(e),null!=e.onSelect)return n(function(){return e.onSelect(e)});if(null!=r.onSelect)return n(function(){return r.onSelect({branch:e})})}},r.user_clicks_branch=function(n){return n!==f?_(n):void 0},s=function(n){var e;return e=void 0,n.parent_uid&&o(function(r){return r.uid===n.parent_uid?e=r:void 0}),e},u=function(n,e){var r;return r=s(n),null!=r?(e(r),u(r,e)):void 0},a=function(n){return u(n,function(n){return n.expanded=!0})},r.tree_rows=[],h=function(){var n,t,i,a,c,u;for(o(function(n,e){return n.uid?void 0:n.uid=""+Math.random()}),console.log("UIDs are set."),o(function(n){var e,r,t,l,i;if(angular.isArray(n.children)){for(l=n.children,i=[],r=0,t=l.length;t>r;r++)e=l[r],i.push(e.parent_uid=n.uid);return i}}),r.tree_rows=[],o(function(n){var e,r;return n.children?n.children.length>0?(r=function(n){return"string"==typeof n?{label:n,children:[]}:n},n.children=function(){var t,l,i,a;for(i=n.children,a=[],t=0,l=i.length;l>t;t++)e=i[t],a.push(r(e));return a}()):void 0:n.children=[]}),n=function(t,i,a){var c,u,o,s,d,h,_;if(null==i.expanded&&(i.expanded=!1),null==i.classes&&(i.classes=[]),i.noLeaf||i.children&&0!==i.children.length?o=i.expanded?l.iconCollapse:l.iconExpand:(o=l.iconLeaf,e.call(i.classes,"leaf")<0&&i.classes.push("leaf")),r.tree_rows.push({level:t,branch:i,label:i.label,classes:i.classes,tree_icon:o,visible:a}),null!=i.children){for(h=i.children,_=[],s=0,d=h.length;d>s;s++)c=h[s],u=a&&i.expanded,_.push(n(t+1,c,u));return _}},c=r.treeData,u=[],i=0,a=c.length;a>i;i++)t=c[i],u.push(n(1,t,!0));return u},r.$watch("treeData",h,!0),null!=l.initialSelection&&o(function(e){return e.label===l.initialSelection?n(function(){return _(e)}):void 0}),d=r.treeData.length,console.log("num root branches = "+d),o(function(n,e){return n.level=e,n.expanded=n.level<c}),null!=r.treeControl&&angular.isObject(r.treeControl)?(g=r.treeControl,g.expand_all=function(){return o(function(n,e){return n.expanded=!0})},g.collapse_all=function(){return o(function(n,e){return n.expanded=!1})},g.get_first_branch=function(){return d=r.treeData.length,d>0?r.treeData[0]:void 0},g.select_first_branch=function(){var n;return n=g.get_first_branch(),g.select_branch(n)},g.get_selected_branch=function(){return f},g.get_parent_branch=function(n){return s(n)},g.select_branch=function(n){return _(n),n},g.get_children=function(n){return n.children},g.select_parent_branch=function(n){var e;return null==n&&(n=g.get_selected_branch()),null!=n&&(e=g.get_parent_branch(n),null!=e)?(g.select_branch(e),e):void 0},g.add_branch=function(n,e){return null!=n?(n.children.push(e),n.expanded=!0):r.treeData.push(e),e},g.add_root_branch=function(n){return g.add_branch(null,n),n},g.expand_branch=function(n){return null==n&&(n=g.get_selected_branch()),null!=n?(n.expanded=!0,n):void 0},g.collapse_branch=function(n){return null==n&&(n=f),null!=n?(n.expanded=!1,n):void 0},g.get_siblings=function(n){var e,t;return null==n&&(n=f),null!=n?(e=g.get_parent_branch(n),t=e?e.children:r.treeData):void 0},g.get_next_sibling=function(n){var e,r;return null==n&&(n=f),null!=n&&(r=g.get_siblings(n),d=r.length,e=r.indexOf(n),d>e)?r[e+1]:void 0},g.get_prev_sibling=function(n){var e,r;return null==n&&(n=f),r=g.get_siblings(n),d=r.length,e=r.indexOf(n),e>0?r[e-1]:void 0},g.select_next_sibling=function(n){var e;return null==n&&(n=f),null!=n&&(e=g.get_next_sibling(n),null!=e)?g.select_branch(e):void 0},g.select_prev_sibling=function(n){var e;return null==n&&(n=f),null!=n&&(e=g.get_prev_sibling(n),null!=e)?g.select_branch(e):void 0},g.get_first_child=function(n){var e;return null==n&&(n=f),null!=n&&(null!=(e=n.children)?e.length:void 0)>0?n.children[0]:void 0},g.get_closest_ancestor_next_sibling=function(n){var e,r;return e=g.get_next_sibling(n),null!=e?e:(r=g.get_parent_branch(n),g.get_closest_ancestor_next_sibling(r))},g.get_next_branch=function(n){var e;return null==n&&(n=f),null!=n?(e=g.get_first_child(n),null!=e?e:e=g.get_closest_ancestor_next_sibling(n)):void 0},g.select_next_branch=function(n){var e;return null==n&&(n=f),null!=n&&(e=g.get_next_branch(n),null!=e)?(g.select_branch(e),e):void 0},g.last_descendant=function(n){var e;return d=n.children.length,0===d?n:(e=n.children[d-1],g.last_descendant(e))},g.get_prev_branch=function(n){var e,r;return null==n&&(n=f),null!=n?(r=g.get_prev_sibling(n),null!=r?g.last_descendant(r):e=g.get_parent_branch(n)):void 0},g.select_prev_branch=function(n){var e;return null==n&&(n=f),null!=n&&(e=g.get_prev_branch(n),null!=e)?(g.select_branch(e),e):void 0}):void 0}}}])}).call(this);
function angularBootstrapNavTree(e,o){e.porciento="",e.buscarPorciento=function(){e.porciento=30},e.buscarPorciento(),e.items=[{label:"Items",children:[]}],e.buscarItems=function(){var o=[],a={compra:10,venta:13,oferta:12,tipo:"item",id:1,dimensiones:1};o.push({label:"Puerta",data:a,onSelect:function(o){return e.pedirDimension(o)}}),e.items[0].children.push({label:"Madera",children:o}),o=[],a={compra:5,venta:8,oferta:7,tipo:"item",id:2,dimensiones:0},o.push({label:"Enganche",data:a,onSelect:function(o){return e.addRow(o)}}),e.items[0].children.push({label:"Tornillo",children:o})},e.buscarItems(),e.modulos=[{label:"Módulos",children:[]}],e.buscarModulos=function(){var o=[],a={compra:20,venta:25,oferta:23,tipo:"modulo",id:3};o.push({label:"Modulo 1",data:a,onSelect:function(o){return e.addRow(o)}}),e.modulos[0].children.push({label:"Baño",children:o}),o=[];var a={compra:20,venta:25,oferta:23,tipo:"modulo",id:3};o.push({label:"Modulo x",data:a,onSelect:function(o){return e.addRow(o)}}),e.modulos[0].children.push({label:"Cocina",children:o})},e.buscarModulos(),e.proformasU=[{label:"Proyectos",onSelect:function(o){return e.selectRaiz(o)},children:[]}],e.buscarProforma=function(){var o=[],a={id:1,numero:1,fecha:"2016-08-04"};o.push({label:"001, 2016-08-04",data:a,onSelect:function(o){return e.selectProf(o)}});var a={id:1};e.proformasU[0].children.push({label:"001, 2016-07-04",data:a,onSelect:function(o){return e.selectProy(o)},children:o})},e.buscarProforma(),e.facturas=[{label:"Facturas",onSelect:function(o){return e.selectRaiz(o)},children:[]}],e.buscarFacturas=function(){var o=[{cantidad:2,concepto:"descripcion del modulo",unitario:40,total:80},{cantidad:1,concepto:"descripcion",unitario:10,total:40}],a={id:1,fecha:"2016-08-04",nombre:"Cliente",ruc:"12345",dir:"Direccion",telef:"012365",correo:"asd@asd.asd",total:120,descuento:20,tarifa:14,modulos:o,num:1};e.facturas[0].children.push({label:"1 (1)",data:a,onSelect:function(o){return e.selectFact(o)}})},e.buscarFacturas(),e.funcionalidades=[{label:"Funcionalidades",children:[]}],e.buscarFuncionalidades=function(){var o={id:1};e.funcionalidades[0].children.push({label:"Nuevo Proyecto",data:o,onSelect:function(o){return e.addRow(o)}}),o={id:2},e.funcionalidades[0].children.push({label:"Gestionar Proyecto",data:o,onSelect:function(o){return e.addRow(o)}}),o={id:3},e.funcionalidades[0].children.push({label:"Nuevo Módulo",data:o,onSelect:function(o){return e.addRow(o)}}),o={id:4},e.funcionalidades[0].children.push({label:"Gestionar Módulo",data:o,onSelect:function(o){return e.addRow(o)}}),o={id:5},e.funcionalidades[0].children.push({label:"Nuevo Item",data:o,onSelect:function(o){return e.addRow(o)}}),o={id:6},e.funcionalidades[0].children.push({label:"Gestionar Item",data:o,onSelect:function(o){return e.addRow(o)}}),o={id:7},e.funcionalidades[0].children.push({label:"Nuevo Tipo de Item",data:o,onSelect:function(o){return e.addRow(o)}}),o={id:8},e.funcionalidades[0].children.push({label:"Gestionar Tipo de Item",data:o,onSelect:function(o){return e.addRow(o)}}),o={id:9},e.funcionalidades[0].children.push({label:"Gestionar Usuarios",data:o,onSelect:function(o){return e.addRow(o)}}),o={id:10},e.funcionalidades[0].children.push({label:"Gestionar Roles",data:o,onSelect:function(o){return e.addRow(o)}}),o={id:11},e.funcionalidades[0].children.push({label:"Notificaciones",data:o,onSelect:function(o){return e.addRow(o)}})},e.buscarFuncionalidades()}angular.module("RDash",["ui.bootstrap","ui.router","ngCookies","angularBootstrapNavTree"]),angular.module("RDash").controller("angularBootstrapNavTree",["$scope","$http",angularBootstrapNavTree]),angular.module("RDash").controller("adicArbolTabla",["$rootScope","$scope","$modal","$http",function(e,o,a,t){o.tCant=1,o.tIndex=0,o.ancho=0,o.largo=0,o.porcientoA="",o.buscarPorciento=function(){o.porcientoA=30},o.buscarPorciento(),o.pedirDimension=function(e){o.openModal("md",e,"dimensiones.html")},o.tratarDimension=function(e){if(e.indexOf(".")>0){var o=e.substring(0,e.indexOf(".")),a=e.substring(e.indexOf("."));e=parseInt(o).toString()+a}else e.indexOf(".")<0?e=parseInt(e).toString():"."===e.substr(0,1)&&(e="0"+e);if(e>0)if(e.indexOf(".")>-1){var t=parseInt(e.length)-e.indexOf(".")-1;2-t>0&&(e+="0".repeat(2-t))}else e+=".00";return e},o.addRow=function(e){var a=/^([0-9])*$/,t=0;o.$parent.listado.length>0&&(t=o.$parent.listado[o.$parent.listado.length-1].index),a.test(t)?o.tIndex=t+1:o.tIndex=o.$parent.listado.length;var r="",i=parseFloat(e.data.compra).toFixed(3),n=parseFloat(e.data.venta).toFixed(2);if(o.ancho>0){o.ancho>0&&(o.ancho=o.tratarDimension(o.ancho)),o.largo>0&&(o.largo=o.tratarDimension(o.largo)),r=" ("+o.ancho+" x "+o.largo+")";var s=o.porcientoA,l=o.ancho*o.largo;i=parseFloat(l*e.data.compra).toFixed(3),n=parseFloat(parseFloat(i*(s/100))+parseFloat(i)).toFixed(2)}if("undefined"!=typeof o.nombreActualizar){$ban=!0;for(var d=0;d<o.$parent.listado.length;d++)if(e.data.id===o.$parent.listado[d].id){$ban=!1;break}$ban?o.$parent.listado.push({index:o.tIndex,nombre:e.label+r,linea:0,cantidad:1,compraU:e.data.compra,ventaU:e.data.venta,ofertaU:e.data.oferta,compraT:i,ventaT:n,ofertaT:e.data.oferta,tipo:e.data.tipo,id:e.data.id,ancho:o.ancho,largo:o.largo,anchoL:0,largoL:0,precioC:0,precioV:0,habilitarD:!0}):o.openModal("xs","Error, ya esa funcionalidad fue elegida.","error.html")}else o.$parent.listado.push({index:o.tIndex,nombre:e.label+r,linea:0,cantidad:1,compraU:e.data.compra,ventaU:e.data.venta,ofertaU:e.data.oferta,compraT:i,ventaT:n,ofertaT:e.data.oferta,tipo:e.data.tipo,id:e.data.id,ancho:o.ancho,largo:o.largo,anchoL:0,largoL:0,precioC:0,precioV:0,habilitarD:!0});("undefined"!=typeof o.nproyecto||"undefined"!=typeof o.gproyecto)&&("undefined"==typeof o.$parent.tlineas[o.tIndex]&&o.$parent.tlineas.push({id:0,nombre:"---------",precioC:0,precioV:0}),o.$parent.tlineas[o.tIndex].selected=0),o.ancho=0,o.largo=0},o.updateLinea=function(e,a){for(var t=0;t<o.$parent.lineas.length;t++)if(o.$parent.lineas[t].id===e){e=t;break}for(var t=0;t<o.$parent.listado.length;t++)if(o.$parent.listado[t].index===a){a=t;break}for(var t=0;t<o.$parent.listado.length;t++)if(t===a){o.$parent.listado[t].linea=e;var r=!1;if(e>0)for(var i=0;i<o.$parent.lineas[e].items.length;i++)if(1===o.$parent.lineas[e].items[i].dimension){r=!0;break}if(r){o.$parent.listado[t].habilitarD=!1;for(var n=0,s=0,l=o.$parent.listado[t].anchoL*o.$parent.listado[t].largoL,i=0;i<o.$parent.lineas[e].items.length;i++)1===o.$parent.lineas[e].items[i].dimension?(n=parseFloat(parseFloat(n)+parseFloat(o.$parent.lineas[e].items[i].cantidad*l*o.$parent.lineas[e].items[i].compra)).toFixed(3),s=parseFloat(parseFloat(s)+parseFloat(o.$parent.lineas[e].items[i].cantidad*l*o.$parent.lineas[e].items[i].venta)).toFixed(2)):(n=parseFloat(parseFloat(n)+parseFloat(o.$parent.lineas[e].items[i].cantidad*o.$parent.lineas[e].items[i].compra)).toFixed(3),s=parseFloat(parseFloat(s)+parseFloat(o.$parent.lineas[e].items[i].cantidad*o.$parent.lineas[e].items[i].venta)).toFixed(2));o.$parent.listado[t].compraT=parseFloat(parseFloat(o.$parent.listado[t].cantidad*n)+parseFloat(o.$parent.listado[t].cantidad*o.$parent.listado[t].compraU)).toFixed(3),o.$parent.listado[t].ventaT=parseFloat(parseFloat(o.$parent.listado[t].cantidad*s)+parseFloat(o.$parent.listado[t].cantidad*o.$parent.listado[t].ventaU)).toFixed(2),o.$parent.listado[t].ofertaT=parseFloat(parseFloat(o.$parent.listado[t].cantidad*s)+parseFloat(o.$parent.listado[t].cantidad*o.$parent.listado[t].ofertaU)).toFixed(2),o.$parent.listado[t].precioC=n,o.$parent.listado[t].precioV=s}else o.$parent.listado[t].compraT=parseFloat(parseFloat(o.$parent.listado[t].cantidad*o.$parent.lineas[e].precioC)+parseFloat(o.$parent.listado[t].cantidad*o.$parent.listado[t].compraU)).toFixed(3),o.$parent.listado[t].ventaT=parseFloat(parseFloat(o.$parent.listado[t].cantidad*o.$parent.lineas[e].precioV)+parseFloat(o.$parent.listado[t].cantidad*o.$parent.listado[t].ventaU)).toFixed(2),o.$parent.listado[t].ofertaT=parseFloat(parseFloat(o.$parent.listado[t].cantidad*o.$parent.lineas[e].precioV)+parseFloat(o.$parent.listado[t].cantidad*o.$parent.listado[t].ofertaU)).toFixed(2),o.$parent.listado[t].precioC=o.$parent.lineas[e].precioC,o.$parent.listado[t].precioV=o.$parent.lineas[e].precioV,o.$parent.listado[t].anchoL=0,o.$parent.listado[t].largoL=0,o.$parent.listado[t].habilitarD=!0;break}},o.updateCantidadP=function(e,a){for(var t=o.$parent.listado.length-1;t>=0;t--)o.$parent.listado[t].index===a&&(o.$parent.listado[t].cantidad=e,$precioC=o.$parent.listado[t].precioC,$precioV=o.$parent.listado[t].precioV,o.$parent.listado[t].compraT=parseFloat(parseFloat(e*$precioC)+parseFloat(e*o.$parent.listado[t].compraU)).toFixed(3),o.$parent.listado[t].ventaT=parseFloat(parseFloat(e*$precioV)+parseFloat(e*o.$parent.listado[t].ventaU)).toFixed(2),o.$parent.listado[t].ofertaT=parseFloat(parseFloat(e*$precioV)+parseFloat(e*o.$parent.listado[t].ofertaU)).toFixed(2))},o.updateCantidadM=function(e,a){for(var t=o.$parent.listado.length-1;t>=0;t--)if(o.$parent.listado[t].index===a){var r=o.$parent.listado[t].ancho,i=o.$parent.listado[t].largo;o.$parent.listado[t].cantidad=e;var n=r*i;n>0?(o.$parent.listado[t].compraT=parseFloat(n*e*o.$parent.listado[t].compraU).toFixed(3),o.$parent.listado[t].ventaT=parseFloat(n*e*o.$parent.listado[t].ventaU).toFixed(2)):(o.$parent.listado[t].compraT=parseFloat(e*o.$parent.listado[t].compraU).toFixed(3),o.$parent.listado[t].ventaT=parseFloat(e*o.$parent.listado[t].ventaU).toFixed(2))}},o.updateOferta=function(e,a){for(var t=o.$parent.listado.length-1;t>=0;t--)o.$parent.listado[t].index===e&&(o.$parent.listado[t].ofertaT=a)},o.openModal=function(e,o,t){a.open({templateUrl:t,controller:"myModalController",size:e,backdrop:"static",keyboard:!1,resolve:{Items:function(){return o}}})},e.$on("evento",function(e,a){for(var t=o.$parent.listado.length-1;t>=0;t--)o.$parent.listado[t].index===a&&o.$parent.listado.splice(t,1)}),e.$on("dimensiones",function(e,a,t){o.ancho=a.ancho,o.largo=a.largo,o.addRow(t)}),o.itemsL=[],o.verItems=function(){for(var e=0;e<o.$parent.listado.length;e++)o.$parent.listado[e].anchoL>0&&(o.$parent.listado[e].anchoL=o.tratarDimension(o.$parent.listado[e].anchoL)),o.$parent.listado[e].largoL>0&&(o.$parent.listado[e].largoL=o.tratarDimension(o.$parent.listado[e].largoL));for(var a=[],e=0;e<o.$parent.listado.length;e++){for(var t=!0,r=0;r<a.length;r++)if(a[r].id===o.$parent.listado[e].id&&a[r].lineaI===o.$parent.listado[e].linea&&a[r].anchoL===o.$parent.listado[e].anchoL&&a[r].largoL===o.$parent.listado[e].largoL){a[r].cantidad=parseInt(a[r].cantidad)+parseInt(o.$parent.listado[e].cantidad),a[r].compra=parseFloat(parseFloat(a[r].compra)+parseFloat(o.$parent.listado[e].compraT)).toFixed(3),a[r].venta=parseFloat(parseFloat(a[r].venta)+parseFloat(o.$parent.listado[e].ventaT)).toFixed(2),a[r].oferta=parseFloat(parseFloat(a[r].oferta)+parseFloat(o.$parent.listado[e].ofertaT)).toFixed(2),t=!1;break}t&&a.push({id:o.$parent.listado[e].id,nombre:o.$parent.listado[e].nombre,cantidad:o.$parent.listado[e].cantidad,compra:o.$parent.listado[e].compraT,venta:o.$parent.listado[e].ventaT,oferta:o.$parent.listado[e].ofertaT,lineaN:o.$parent.lineas[o.$parent.listado[e].linea].nombre,lineaI:o.$parent.listado[e].linea,anchoL:o.$parent.listado[e].anchoL,largoL:o.$parent.listado[e].largoL})}for(var i="",e=0;e<a.length;e++)i+=""===i?"mod"+e+"="+a[e].id+"&lin"+e+"="+a[e].lineaI+"&cant"+e+"="+a[e].cantidad+"&ancho="+a[e].anchoL+"&largo="+a[e].largoL:"&mod"+e+"="+a[e].id+"&lin"+e+"="+a[e].lineaI+"&cant"+e+"="+a[e].cantidad+"&ancho="+a[e].anchoL+"&largo="+a[e].largoL;var n=[];n.push({idI:1,nombre:"Item1",compra:10,venta:15,compraL:5,ventaL:8,cantidad:2,ancho:0,largo:0,cantT:4,compraT:40,ventaT:60}),o.itemsL=[{idM:1,idL:1,items:n,cantidad:2,ancho:0,largo:0}],o.itemsL.push({idM:"T",idL:"",items:n});var s={nombre:o.$parent.nombreP,listado:o.itemsL,modulo:a};o.openModal("lg",s,"lItems.html")}}]),angular.module("RDash").controller("dateController",["$scope","datepickerPopupConfig",function(e,o){e.today=function(){e.$parent.dtInicio=new Date,e.$parent.dtEntrega=new Date},e.today(),e.clear=function(){e.$parent.dtInicio=null,e.$parent.dtEntrega=null},e.dateOptions={formatYear:"yy",startingDay:1,showWeeks:"false"},e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","shortDate","fullDate"],e.format=e.formats[3],e.disabled=function(e,o){return"day"===o&&(0===e.getDay()||6===e.getDay())},e.inicio={opened:!1},e.entrega={opened:!1},e.openInicio=function(o){e.inicio.opened?e.inicio.opened=!1:(e.inicio.opened=!0,o.preventDefault(),o.stopPropagation(),e.entrega.opened=!1)},e.openEntrega=function(o){e.entrega.opened?e.entrega.opened=!1:(e.entrega.opened=!0,o.preventDefault(),o.stopPropagation(),e.inicio.opened=!1)},e.maxDate=new Date(2500,12,31),e.minDate=new Date(2e3,1,1),o.currentText="Hoy",o.clearText="Borrar",o.closeText="Cerrar"}]),angular.module("RDash").controller("myModalController",["$rootScope","$scope","$modalInstance","Items",function(e,o,a,t){o.items=t,o.aI=0,o.lI=0,o.$parent.errorA=!1,o.$parent.errorL=!1,o.elimLista=function(o){e.$broadcast("eliminarLista",o),a.dismiss("delete")},o.elimElemento=function(o,t){e.$broadcast(t,o),a.dismiss("delete")},o.cancel=function(){a.dismiss("cancel")},o.downloadPdf=function(e,a,t){var r;switch(a){case"PdfItems":r=o.PdfItems(e);break;case"PdfProyecto":r=t?o.PdfProyectoModulos(e):o.PdfProyectoItems(e)}pdfMake.createPdf(r).download()},o.PdfItems=function(e){var o=[],a=new Array({text:"Nombre",style:"tableHeader"},{text:"Código",style:"tableHeader"},{text:"Descripción",style:"tableHeader"});o.push(a);for(var t=0;t<e.length;t++){var r=new Array;r.push(e[t].nombre),r.push(e[t].codigo),r.push(e[t].descripcion),o.push(r)}return docDefinition={content:[{style:"header",text:"Listado de Items"},{style:"demoTable",table:{headerRows:1,widths:["*","*","*"],body:o}}],styles:{header:{bold:!0,color:"#000",fontSize:11,margin:20},demoTable:{color:"#666",fontSize:10},tableHeader:{bold:!0,color:"black",alignment:"center",fillColor:"#EEEAE9"}}}},o.PdfProyectoItems=function(e){var o=[],a=new Array({text:"Nombre",style:"tableHeader"},{text:"Cantidad",style:"tableHeader"},{text:"Compra",style:"tableHeader"},{text:"Venta",style:"tableHeader"});o.push(a);for(var t=0;t<e.listado[0].length;t++)if("T"===e.listado[0][t].idM)for(var r=0;r<e.listado[0][t].items.length;r++){var i=new Array;i.push(e.listado[0][t].items[r].nombre),i.push({text:e.listado[0][t].items[r].cantidad.toString(),style:"colCentro"}),i.push({text:e.listado[0][t].items[r].compraT.toString(),style:"colDerecha"}),i.push({text:e.listado[0][t].items[r].ventaT.toString(),style:"colDerecha"}),o.push(i)}return docDefinition={content:[{style:"header",text:"Listado de Items del Proyecto "+e.nombre},{style:"demoTable",table:{headerRows:1,widths:["*","*","*","*"],body:o}}],styles:{header:{bold:!0,color:"#000",fontSize:11,margin:20},demoTable:{color:"#666",fontSize:10},tableHeader:{bold:!0,color:"black",alignment:"center",fillColor:"#EEEAE9"},colCentro:{alignment:"center"},colDerecha:{alignment:"right"},colIzquierda:{alignment:"right"}}}},o.PdfProyectoModulos=function(e){var o=[],a=new Array({text:"Nombre",style:"tableHeader"},{text:"Cantidad",style:"tableHeader"},{text:"Compra",style:"tableHeader"},{text:"Venta",style:"tableHeader"},{text:"Oferta",style:"tableHeader"});o.push(a);for(var t=0;t<e.modulo.length;t++){var r=new Array;r.push({text:e.modulo[t].nombre+", "+e.modulo[t].lineaN,style:"filaModulo"}),r.push({text:e.modulo[t].cantidad.toString(),style:"filaModuloCentro"}),r.push({text:e.modulo[t].compra.toString(),style:"filaModuloDerecha"}),r.push({text:e.modulo[t].venta.toString(),style:"filaModuloDerecha"}),r.push({text:e.modulo[t].oferta.toString(),style:"filaModuloDerecha"}),o.push(r);for(var i=0;i<e.listado[0].length;i++)if("T"!==e.listado[0][i].idM)for(var n=0;n<e.listado[0][i].items.length;n++)if(e.modulo[t].id===e.listado[0][i].idM&&e.modulo[t].lineaI===e.listado[0][i].idL&&e.modulo[t].ancho===e.listado[0][i].anchoL&&e.modulo[t].largo===e.listado[0][i].largoL){var s=new Array;s.push(e.listado[0][i].items[n].nombre),s.push({text:e.listado[0][i].items[n].cantidad.toString(),style:"colCentro"}),s.push({text:e.listado[0][i].items[n].compraT.toString(),style:"colDerecha"}),s.push({text:e.listado[0][i].items[n].ventaT.toString(),style:"colDerecha"}),s.push(""),o.push(s)}}return docDefinition={content:[{style:"header",text:"Listado de Items del Proyecto "+e.nombre},{style:"demoTable",table:{headerRows:1,widths:["*","*","*","*","*"],body:o}}],styles:{header:{bold:!0,color:"#000",fontSize:11,margin:20},demoTable:{color:"#666",fontSize:10},tableHeader:{bold:!0,color:"black",alignment:"center",fillColor:"#EEEAE9"},filaModulo:{bold:!0,color:"black",fillColor:"#F7F7F7"},filaModuloCentro:{bold:!0,color:"black",alignment:"center",fillColor:"#F7F7F7"},filaModuloDerecha:{bold:!0,color:"black",alignment:"right",fillColor:"#F7F7F7"},colCentro:{alignment:"center"},colDerecha:{alignment:"right"},colIzquierda:{alignment:"right"}}}},o.salvarD=function(){var t=!0,r=/^\d{0,9}(\.\d{1,2})?$/;if((!r.test(o.aI)||o.aI<=0)&&(t=!1,o.$parent.errorA=!0),(!r.test(o.lI)||o.lI<=0)&&(t=!1,o.$parent.errorL=!0),t){"."===o.aI.charAt(0)&&(o.aI="0"+o.aI),"."===o.lI.charAt(0)&&(o.lI="0"+o.lI);var i={ancho:o.aI,largo:o.lI};o.$parent.errorA=!1,o.$parent.errorL=!1,e.$broadcast("dimensiones",i,o.items),a.dismiss("delete")}},o.cargarM=function(o){e.$broadcast("cargarM",o),a.dismiss("delete")},o.cargarP=function(o){e.$broadcast("cargarP",o),a.dismiss("delete")}}]),angular.module("RDash").controller("nProyecto",["$scope","$http","$modal","$rootScope","$location","$window","$stateParams","$state",function(e,o,a,t,r,i,n,s){e.listado=[],e.nproyecto=!0,e.clientes=[],e.rucs=[],e.errorP=!1,e.lectura=!1,e.nombreP="",e.numeroP="",e.numero="",e.anno="",e.logueado=!1,e.tratarDimension=function(e){if(e.indexOf(".")>0){var o=e.substring(0,e.indexOf(".")),a=e.substring(e.indexOf("."));e=parseInt(o).toString()+a}else e.indexOf(".")<0?e=parseInt(e).toString():"."===e.substr(0,1)&&(e="0"+e);if(e>0)if(e.indexOf(".")>-1){var t=parseInt(e.length)-e.indexOf(".")-1;2-t>0&&(e+="0".repeat(2-t))}else e+=".00";return e},e.verificarPrivilegio=function(){"undefined"!=typeof i.sessionStorage.nProy&&(e.logueado=i.sessionStorage.nProy),e.logueado||r.path("/Sesion")},e.buscarNumero=function(){o.get("model/buscarNProyecto.php").then(function(o){e.numero=o.data.numero,e.anno=o.data.anno,e.numeroP="0".repeat(3-e.numero.toString.length)+e.numero+"-"+e.anno})},e.buscarNumero(),e.buscarClientes=function(){o.get("model/buscarClientes.php").then(function(o){e.clientes=o.data,e.rucs=[];for(var a=0;a<o.data.length;a++)e.rucs.push(o.data[a].ruc)})},e.buscarClientes(),e.descripcionP="",e.rucC="",e.nombreC="",e.direccionC="",e.telefonoC="",e.emailC="",e.idCBD="",e.dtInicio=new Date,e.dtEntrega=new Date,e.lineas=[{id:0,nombre:"---------",precioC:0,precioV:0}],e.lineas.selected=0,e.tlineas=[{id:0,nombre:"---------",precioC:0,precioV:0}],e.buscarLineas=function(){var o=[{nombre:"Puerta",id:1,cantidad:3,compra:10,venta:15},{nombre:"Mano de Obra",id:2,cantidad:1,compra:20,venta:25}];e.lineas.push({id:1,nombre:"Linea1",precioC:20,precioV:25,items:o}),o=[{nombre:"Enganche",id:1,cantidad:6,compra:5,venta:8},{nombre:"Mano de Obra",id:2,cantidad:1,compra:10,venta:15}],e.lineas.push({id:2,nombre:"Linea2",precioC:15,precioV:18,items:o})},e.buscarLineas(),e.updateDimensionL=function(o,a,t){for(var r=0;r<e.listado.length;r++)if(e.listado[r].index===a){a=r;break}"A"===t&&(e.listado[a].anchoL=e.tratarDimension(e.listado[a].anchoL)),"L"===t&&(e.listado[a].largoL=e.tratarDimension(e.listado[a].largoL));for(var i=0,n=0,s=e.listado[a].anchoL*e.listado[a].largoL,l=0;l<e.lineas[o].items.length;l++)1===e.lineas[o].items[l].dimension?(i=parseFloat(parseFloat(i)+parseFloat(e.lineas[o].items[l].cantidad*s*e.lineas[o].items[l].compra)).toFixed(3),n=parseFloat(parseFloat(n)+parseFloat(e.lineas[o].items[l].cantidad*s*e.lineas[o].items[l].venta)).toFixed(2)):(i=parseFloat(parseFloat(i)+parseFloat(e.lineas[o].items[l].cantidad*e.lineas[o].items[l].compra)).toFixed(3),n=parseFloat(parseFloat(n)+parseFloat(e.lineas[o].items[l].cantidad*e.lineas[o].items[l].venta)).toFixed(2));e.listado[a].compraT=parseFloat(parseFloat(e.listado[a].cantidad*i)+parseFloat(e.listado[a].cantidad*e.listado[a].compraU)).toFixed(3),e.listado[a].ventaT=parseFloat(parseFloat(e.listado[a].cantidad*n)+parseFloat(e.listado[a].cantidad*e.listado[a].ventaU)).toFixed(2),e.listado[a].ofertaT=parseFloat(parseFloat(e.listado[a].cantidad*n)+parseFloat(e.listado[a].cantidad*e.listado[a].ofertaU)).toFixed(2),e.listado[a].precioC=i,e.listado[a].precioV=n},e.actualizarLineas=function(){for(var o=0,a=0;a<e.lineas.length;a++)if(e.lineas[a].id===e.lineas.selected){o=a;break}for(var a=0;a<e.tlineas.length;a++)e.tlineas[a].selected=e.lineas[o].id;for(var a=0;a<e.listado.length;a++){e.listado[a].linea=o;var t=!1;if(o>0)for(var r=0;r<e.lineas[o].items.length;r++)if(1===e.lineas[o].items[r].dimension){t=!0;break}if(t){e.listado[a].habilitarD=!1;for(var i=0,n=0,s=e.listado[a].anchoL*e.listado[a].largoL,r=0;r<e.lineas[o].items.length;r++)1===e.lineas[o].items[r].dimension?(i=parseFloat(parseFloat(i)+parseFloat(e.lineas[o].items[r].cantidad*s*e.lineas[o].items[r].compra)).toFixed(3),n=parseFloat(parseFloat(n)+parseFloat(e.lineas[o].items[r].cantidad*s*e.lineas[o].items[r].venta)).toFixed(2)):(i=parseFloat(parseFloat(i)+parseFloat(e.lineas[o].items[r].cantidad*e.lineas[o].items[r].compra)).toFixed(3),n=parseFloat(parseFloat(n)+parseFloat(e.lineas[o].items[r].cantidad*e.lineas[o].items[r].venta)).toFixed(2));e.listado[a].compraT=parseFloat(parseFloat(e.listado[a].cantidad*i)+parseFloat(e.listado[a].cantidad*e.listado[a].compraU)).toFixed(3),e.listado[a].ventaT=parseFloat(parseFloat(e.listado[a].cantidad*n)+parseFloat(e.listado[a].cantidad*e.listado[a].ventaU)).toFixed(2),e.listado[a].ofertaT=parseFloat(parseFloat(e.listado[a].cantidad*n)+parseFloat(e.listado[a].cantidad*e.listado[a].ofertaU)).toFixed(2),e.listado[a].precioC=i,e.listado[a].precioV=n}else e.listado[a].compraT=parseFloat(parseFloat(e.listado[a].cantidad*e.lineas[o].precioC)+parseFloat(e.listado[a].cantidad*e.listado[a].compraU)).toFixed(3),e.listado[a].ventaT=parseFloat(parseFloat(e.listado[a].cantidad*e.lineas[o].precioV)+parseFloat(e.listado[a].cantidad*e.listado[a].ventaU)).toFixed(2),e.listado[a].ofertaT=parseFloat(parseFloat(e.listado[a].cantidad*e.lineas[o].precioV)+parseFloat(e.listado[a].cantidad*e.listado[a].ofertaU)).toFixed(2),e.listado[a].precioC=e.lineas[o].precioC,e.listado[a].precioV=e.lineas[o].precioV,e.listado[a].anchoL=0,e.listado[a].largoL=0,e.listado[a].habilitarD=!0}},e.costo=function(){for(var o=0,a=e.listado.length-1;a>=0;a--)o+=parseFloat(e.listado[a].compraT);return parseFloat(o).toFixed(3)},e.venta=function(){for(var o=0,a=e.listado.length-1;a>=0;a--)o+=parseFloat(e.listado[a].ventaT);return parseFloat(o).toFixed(2)},e.oferta=function(){for(var o=0,a=e.listado.length-1;a>=0;a--)o+=parseFloat(e.listado[a].ofertaT);return parseFloat(o).toFixed(2)},e.actualizarCliente=function(){for(var o=!0,a=0;a<e.clientes.length;a++)if(e.clientes[a].ruc===e.rucC){e.nombreC=e.clientes[a].nombre,e.telefonoC=e.clientes[a].telefono,e.emailC=e.clientes[a].correo,e.direccionC=e.clientes[a].direccion,e.idCBD=e.clientes[a].id,e.lectura=!0,o=!1;break}o&&(e.nombreC="",e.telefonoC="",e.emailC="",e.direccionC="",e.idCBD="",e.lectura=!1)},e.guardar=function(){e.errorListado=[],e.errorIndex=0;var o=!1,a=/^([a-zA-Z- -ñÑ])+$/,t=/^([0-9])*$/,r=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/,i=/^\d{0,9}(\.\d{1,2})?$/;""===e.nombreP&&(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar un nombre para el proyecto."}),e.errorIndex++),""===e.descripcionP&&(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar una descripción para el proyecto."}),e.errorIndex++),(e.dtInicio.toLocaleDateString()===e.dtEntrega.toLocaleDateString()||new Date(e.dtInicio)>new Date(e.dtEntrega))&&(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe escoger una fecha de entrega posterior a la fecha de inicio."}),e.errorIndex++),""===e.rucC?(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar una identificación para el cliente."}),e.errorIndex++):t.test(e.rucC)||(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar un número de identificación válido para el cliente."}),e.errorIndex++),""===e.nombreC?(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar el nombre del cliente."}),e.errorIndex++):a.test(e.nombreC)||(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar un nombre válido para el cliente."}),e.errorIndex++),""===e.direccionC&&(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar la dirección del cliente."}),e.errorIndex++),""===e.telefonoC?(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar un número de teléfono del cliente."}),e.errorIndex++):t.test(e.telefonoC)||(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar un número de teléfono válido para el cliente."}),e.errorIndex++),""===e.emailC?(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar un correo electrónico del cliente."}),e.errorIndex++):r.test(e.emailC)||(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar un correo electrónico válido para el cliente."}),e.errorIndex++),0===e.listado.length&&(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe ser escogido al menos un módulo para utilizar en el proyecto."}),e.errorIndex++);for(var l=0;l<e.listado.length;l++){var d=!1;if(e.listado[l].linea>0){for(var c=0;c<e.lineas[e.listado[l].linea].items.length;c++)if(1===e.lineas[e.listado[l].linea].items[c].dimension){d=!0;break}d&&(t.test(e.listado[l].anchoL)&&t.test(e.listado[l].largoL)||i.test(e.listado[l].anchoL)&&i.test(e.listado[l].largoL)?(0===parseFloat(e.listado[l].anchoL)||0===parseFloat(e.listado[l].largoL))&&(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar las dimensiones para la línea en el módulo "+e.listado[l].nombre+"."}),e.errorIndex++):(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Las dimensiones especificadas para la línea no son correctas en el módulo "+e.listado[l].nombre+"."}),e.errorIndex++))}}for(var l=0;l<e.listado.length;l++)t.test(e.listado[l].ofertaT)||i.test(e.listado[l].ofertaT)||(o=!0,e.errorListado.push({index:e.errorIndex,texto:"La oferta especificada no es correcta en el módulo "+e.listado[l].nombre+"."}),e.errorIndex++);if(o)e.errorP=!0;else{e.errorP=!1;for(var l=0;l<e.listado.length;l++)e.listado[l].anchoL>0&&(e.listado[l].anchoL=e.tratarDimension(e.listado[l].anchoL)),e.listado[l].largoL>0&&(e.listado[l].largoL=e.tratarDimension(e.listado[l].largoL));for(var p=[],l=0;l<e.listado.length;l++){for(var d=!0,c=0;c<p.length;c++)if(p[c].id===e.listado[l].id&&p[c].linea===e.listado[l].linea&&p[c].anchoL===e.listado[l].anchoL&&p[c].largoL===e.listado[l].largoL){p[c].cantidad=parseInt(p[c].cantidad)+parseInt(e.listado[l].cantidad),d=!1;break}d&&p.push(e.listado[l])}var u="false";e.lectura&&(u="true");({nombreP:e.nombreP,nombreC:e.nombreC,ruc:e.rucC,dir:e.direccionC,tel:e.telefonoC,correo:e.emailC,numero:e.numero,anno:e.anno,desc:e.descripcionP,finicio:new Date(e.dtInicio),fentrega:new Date(e.dtEntrega),linea:e.lineas[e.lineas.selected].id,listado:p,compra:e.costo(),venta:e.venta(),oferta:e.oferta(),lectura:u,idC:e.idCBD});e.openModal("sm","Insertado correctamente el proyecto.","ok.html"),n.page=1,s.reload()}},e.openModal=function(e,o,t){a.open({templateUrl:t,controller:"myModalController",size:e,resolve:{Items:function(){return o}}})},e.cargar=function(){var o=[],a="0".repeat(3-"2".length)+2+"-2016, Proyecto2";o.push({id:2,nombre:a}),a="0".repeat(3-"1".length)+1+"-2016, Proyecto1",o.push({id:1,nombre:a}),e.openModal("md",o,"proyectos.html")},t.$on("cargarP",function(o,a){var t=[];e.cargarP(t)}),e.cargarP=function(o){alert("asd"),e.proyectos=o[0],e.nombreP=e.proyectos.nombre,e.idP=e.proyectos.id,e.descripcionP=e.proyectos.descripcion,e.rucC="12334",e.nombreC=e.proyectos.nombreC,e.direccionC=e.proyectos.direccion,e.idCBD=e.proyectos.cliente,e.telefonoC=e.proyectos.telefono,e.emailC=e.proyectos.email,e.dtInicio=new Date(e.proyectos.inicio),e.dtInicio.setMinutes(e.dtInicio.getMinutes()+e.dtInicio.getTimezoneOffset()),e.dtEntrega=new Date(e.proyectos.entrega),e.dtEntrega.setMinutes(e.dtEntrega.getMinutes()+e.dtEntrega.getTimezoneOffset()),e.lineas.selected=e.proyectos.linea,e.lectura=!0,e.listado=[];for(var a=0,t=e.proyectos.modulos.length-1;t>=0;t--){var r=e.proyectos.modulos[t].cantidad,i=e.proyectos.modulos[t].linea,n=0,s=0,l=!0;if(e.proyectos.modulos[t].ancho>0&&e.proyectos.modulos[t].largo>0){l=!1;for(var d=e.proyectos.modulos[t].ancho*e.proyectos.modulos[t].largo,c=0;c<e.lineas[i].items.length;c++)1===e.lineas[i].items[c].dimension?(n=parseFloat(parseFloat(n)+parseFloat(e.lineas[i].items[c].cantidad*d*e.lineas[i].items[c].compra)).toFixed(3),s=parseFloat(parseFloat(s)+parseFloat(e.lineas[i].items[c].cantidad*d*e.lineas[i].items[c].venta)).toFixed(2)):(n=parseFloat(parseFloat(n)+parseFloat(e.lineas[i].items[c].cantidad*e.lineas[i].items[c].compra)).toFixed(3),s=parseFloat(parseFloat(s)+parseFloat(e.lineas[i].items[c].cantidad*e.lineas[i].items[c].venta)).toFixed(2))}else n=e.lineas[i].precioC,s=e.lineas[i].precioV;var p=parseFloat(parseFloat(r*n)+parseFloat(r*e.proyectos.modulos[t].compra)).toFixed(3),u=parseFloat(parseFloat(r*s)+parseFloat(r*e.proyectos.modulos[t].venta)).toFixed(2);e.listado.push({index:a,nombre:e.proyectos.modulos[t].nombre,linea:i,cantidad:r,compraU:e.proyectos.modulos[t].compra,ventaU:e.proyectos.modulos[t].venta,compraT:p,ventaT:u,tipo:"modulo",ofertaU:e.proyectos.modulos[t].oferta,ofertaT:e.proyectos.modulos[t].ofertaT,anchoL:e.proyectos.modulos[t].ancho,largoL:e.proyectos.modulos[t].largo,precioC:n,precioV:s,id:e.proyectos.modulos[t].id,habilitarD:l}),"undefined"==typeof e.tlineas[a]&&e.tlineas.push({id:0,nombre:"---------",precioC:0,precioV:0}),e.tlineas[a].selected=i,a++}},t.$on("eliminarLista",function(o,a){for(var t=e.listado.length-1;t>=0;t--)e.listado[t].index===a&&e.listado.splice(t,1)})}]),angular.module("RDash").controller("Linea",["$scope","$modal","$http","$location","$window","$rootScope",function(e,o,a,t,r,i){e.listado=[],e.logueado=!1,e.verificarPrivilegio=function(){"undefined"!=typeof r.sessionStorage.nLin&&(e.logueado=r.sessionStorage.nLin),e.logueado||t.path("/Sesion")},e.guardar=function(){for(var o=[],t=e.listado.length-1;t>=0;t--){for(var r=!0,i=0;i<o.length;i++)if(o[i].id===e.listado[t].id){o[i].cantidad=parseInt(o[i].cantidad)+parseInt(e.listado[t].cantidad),r=!1;break}r&&o.push(e.listado[t])}var n={nombre:e.nombreL,codigo:e.codigoL,desc:e.descripcionL,listado:o,compra:e.costoL(),venta:e.ventaL()};a.post("model/insertarLinea.php",n).success(function(o){"OK"===o?(e.openModal("sm","Insertada correctamente la línea.","ok.html"),e.listado=[],e.nombreL="",e.codigoL="",e.descripcionL="",e.formL.$pristine=!0):"existe"===o?e.openModal("sm","Ya existe una línea con ese nombre.","error.html"):e.openModal("sm",o,"error.html")}).error(function(o){e.openModal("xs",o,"error.html")})},e.costoL=function(){for(var o=0,a=e.listado.length-1;a>=0;a--)o+=parseFloat(e.listado[a].compraT);return parseFloat(o).toFixed(3)},e.ventaL=function(){for(var o=0,a=e.listado.length-1;a>=0;a--)o+=parseFloat(e.listado[a].ventaT);return parseFloat(o).toFixed(2)},e.openModal=function(e,a,t){o.open({templateUrl:t,controller:"myModalController",size:e,resolve:{Items:function(){return a}}})},i.$on("eliminarLista",function(o,a){for(var t=e.listado.length-1;t>=0;t--)e.listado[t].index===a&&e.listado.splice(t,1)})}]),angular.module("RDash").controller("nItem",["$scope","$http","$modal","$location","$window",function(e,o,a,t,r){e.dinamicos=[],e.patronEntero=/^([0-9])*$/,e.patronDecimal=/^\d{0,9}(\.\d{1,2})?$/,e.patronLetras=/^([a-zA-Z- -ñÑ])+$/,
e.tipos=[{id:0,nombre:"---------"}],e.activo=!1,e.logueado=!1,e.verificarPrivilegio=function(){"undefined"!=typeof r.sessionStorage.nIt&&(e.logueado=r.sessionStorage.nIt),e.logueado||t.path("/Sesion")},e.buscarTipos=function(){e.tipos=[{id:0,nombre:"---------"}];var o=[];o.push({nombre:"Caras",tipo:e.patronLetras,identificador:"1",valor:"",id:"1"}),e.tipos.push({id:"1",nombre:"Madera",campos:o}),o=[],o.push({nombre:"Grosor",tipo:e.patronDecimal,identificador:"2",valor:"",id:"2"}),o.push({nombre:"Longitud",tipo:e.patronDecimal,identificador:"3",valor:"",id:"3"}),e.tipos.push({id:"2",nombre:"Tornillo",campos:o})},e.buscarTipos(),e.tipos.selected=0,e.nombre="",e.nombreI="",e.codigoI="",e.descripcionI="",e.compraI="",e.ventaI="",e.porciento="",e.buscarPorciento=function(){e.porciento=30},e.buscarPorciento(),e.identificador=e.tipos[0].nombre+e.tipos[0].id,e.nuevoItem=[],e.actualizarNombres=function(){for(var o=0;o<e.tipos.length;o++)if(e.tipos[o].id===e.tipos.selected){e.dinamicos=e.tipos[o].campos;break}},e.guardar=function(){var a="false";e.activo&&(a="true"),e.nuevoItem=[{identificador:"nombre",valor:e.nombreI},{identificador:"codigo",valor:e.codigoI},{identificador:"descripcion",valor:e.descripcionI},{identificador:"compra",valor:e.compraI},{identificador:"venta",valor:e.ventaI},{identificador:"dimension",valor:a}];for(var t=e.tipos.length-1;t>=0;t--)if(e.tipos[t].id===e.tipos.selected){e.nuevoItem.push({identificador:"tipo",valor:e.tipos.selected});for(var r=e.tipos[t].campos.length-1;r>=0;r--)e.nuevoItem.push({identificador:e.tipos[t].campos[r].id,valor:e.tipos[t].campos[r].valor,id:e.tipos[t].campos[r].identificador})}o.post("model/insertarItem.php",e.nuevoItem).success(function(o){"OK"===o?(e.openModal("sm","Insertado correctamente el item.","ok.html"),e.tipos=[{id:0,nombre:"---------"}],e.buscarTipos(),e.tipos.selected=0,e.nombreI="",e.codigoI="",e.descripcionI="",e.compraI="",e.ventaI="",e.activo=!1,e.formItem.$pristine=!0):e.openModal("sm",o,"error.html")}).error(function(o){e.openModal("xs",o,"error.html")})},e.$watch(function(){e.ventaI=parseFloat(parseFloat(e.compraI)*(e.porciento/100)+parseFloat(e.compraI)).toFixed(2)}),e.openModal=function(e,o,t){a.open({templateUrl:t,controller:"myModalController",size:e,resolve:{Items:function(){return o}}})}}]),angular.module("RDash").controller("nTipoItem",["$rootScope","$scope","$modal","$http","$location","$window",function(e,o,a,t,r,i){o.tiposItem=[],o.tiIndex=0,o.tiposCTI=[{id:0,nombre:"--------------"},{id:1,nombre:"Texto"},{id:2,nombre:"Número entero"},{id:3,nombre:"Número decimal"}],o.tiposCTI.selected=0,o.nombreTI="",o.nombreCTI="",o.logueado=!1,o.verificarPrivilegio=function(){"undefined"!=typeof i.sessionStorage.nTIt&&(o.logueado=i.sessionStorage.nTIt),o.logueado||r.path("/Sesion")},o.guardar=function(){o.openModal("xs","Insertado correctamente el tipo de item.","ok.html"),o.tiposItem=[],o.tiIndex=0,o.nombreTI="",o.nombreCTI="",o.tiposCTI.selected=0,o.form.$pristine=!0,o.formItem.$pristine=!0},o.adicionar=function(e){for(var a=!0,t=o.tiposItem.length-1;t>=0;t--)if(o.tiposItem[t].nombre===o.nombreCTI){o.openModal("xs","No puede tener dos campos con el mismo nombre.","error.html"),a=!1;break}a&&(o.tiposItem.push({index:o.tiIndex,nombre:o.nombreCTI,tipoN:o.tiposCTI[e].nombre,tipoI:o.tiposCTI[e].id}),o.tiIndex++,o.nombreCTI="",o.tiposCTI.selected=0,o.form.$pristine=!0)},o.listadoEditar=function(e){for(var a=o.tiposItem.length-1;a>=0;a--)o.tiposItem[a].index===e&&(o.nombreCTI=o.tiposItem[a].nombre,o.tiposCTI.selected=o.tiposItem[a].tipoI,o.tiposItem.splice(a,1))},o.openModal=function(e,o,t){a.open({templateUrl:t,controller:"myModalController",size:e,resolve:{Items:function(){return o}}})},e.$on("eliminarLista",function(e,a){for(var t=o.tiposItem.length-1;t>=0;t--)o.tiposItem[t].index===a&&o.tiposItem.splice(t,1)})}]),angular.module("RDash").controller("nModulo",["$scope","$modal","$http","$rootScope","$location","$window","$stateParams","$state",function(e,o,a,t,r,i,n,s){e.listado=[],e.errorA=!1,e.errorP=!1,e.nombreM="",e.codigoM="",e.ofertaM="",e.descripcionM="",e.cargarModulos=[],e.logueado=!1,e.verificarPrivilegio=function(){"undefined"!=typeof i.sessionStorage.nMod&&(e.logueado=i.sessionStorage.nMod),e.logueado||r.path("/Sesion")},e.porciento="",e.buscarPorciento=function(){e.porciento=30},e.buscarPorciento(),e.area=[{id:0,nombre:"--------"},{id:1,nombre:"Baño"},{id:2,nombre:"Cocina"},{id:3,nombre:"Comedor"}],e.area.selected=0,e.costo=function(){for(var o=0,a=e.listado.length-1;a>=0;a--)o+=parseFloat(e.listado[a].compraT);return parseFloat(o).toFixed(3)},e.venta=function(){for(var o=0,a=e.listado.length-1;a>=0;a--)o+=parseFloat(e.listado[a].ventaT);return parseFloat(o).toFixed(2)},e.oferta=function(){for(var o=0,a=e.listado.length-1;a>=0;a--)o+=parseFloat(e.listado[a].ofertaT);return parseFloat(o).toFixed(2)},e.guardar=function(){e.errorListado=[],e.errorIndex=0;var o=!1,a=/^([a-zA-Z- -ñÑ])+$/,t=/^([a-zA-Z0-9])+$/,r=/^\d{0,9}(\.\d{1,2})?$/;if(""===e.nombreM?(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar un nombre para el módulo."}),e.errorIndex++):a.test(e.nombreM)||(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar un nombre válido para el módulo."}),e.errorIndex++),0===e.area[e.area.selected].id&&(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar el área a utilizar por el módulo."}),e.errorIndex++),""===e.codigoM?(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar un código para el módulo."}),e.errorIndex++):t.test(e.codigoM)||(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar un código válido para el módulo."}),e.errorIndex++),""===e.ofertaM?e.ofertaM=e.venta():r.test(e.ofertaM)||(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar un precio de oferta válido para el módulo."}),e.errorIndex++),""===e.descripcionM&&(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe especificar una descripción para el módulo."}),e.errorIndex++),0===e.listado.length&&(o=!0,e.errorListado.push({index:e.errorIndex,texto:"Debe ser escogido al menos un módulo o un item para utilizar en el módulo."}),e.errorIndex++),o)e.errorP=!0;else{e.errorP=!1;for(var i=[],l=e.listado.length-1;l>=0;l--){for(var d=!0,c=0;c<i.length;c++)if(i[c].id===e.listado[l].id&&i[c].tipo===e.listado[l].tipo&&(i[c].ancho===e.listado[l].ancho&&i[c].largo===e.listado[l].largo&&"item"===i[c].tipo||"modulo"===i[c].tipo)){i[c].cantidad=parseInt(i[c].cantidad)+parseInt(e.listado[l].cantidad),d=!1;break}d&&i.push(e.listado[l])}var p=[],u={compra:e.costo(),venta:e.venta(),oferta:e.ofertaM,tipo:"modulo",id:3};switch(p.push({label:e.nombreM,data:u,onSelect:function(o){return e.addRow(o)}}),e.area[e.area.selected].nombre){case"Baño":break;case"Cocina":break;case"Comedor":}var u={nombre:e.nombreM,codigo:e.codigoM,area:e.area[e.area.selected].nombre,desc:e.descripcionM,oferta:e.ofertaM,listado:i,compra:e.costo(),venta:e.venta()};e.openModal("sm","Insertado correctamente el módulo.","ok.html"),n.page=1,s.reload()}},e.cargar=function(){e.openModal("md",e.cargarModulos,"modulos.html")},e.openModal=function(e,a,t){o.open({templateUrl:t,controller:"myModalController",size:e,resolve:{Items:function(){return a}}})},e.cargarM=function(o){e.modulos=o[0],e.nombreM=e.modulos.nombre,e.idM=e.modulos.id,e.codigoM=e.modulos.codigo,e.ofertaM=e.modulos.oferta,e.descripcionM=e.modulos.descripcion;var a=0;switch(e.modulos.area){case"Baño":a=1;break;case"Cocina":a=2;break;case"Comedor":a=3}e.area.selected=a,e.listado=[];for(var t=0,r=e.modulos.items.length-1;r>=0;r--){var i=e.modulos.items[r].ancho,n=e.modulos.items[r].largo,s=e.modulos.items[r].cantidad,l=e.porciento,d=i*n;d>0?(compra=parseFloat(d*s*e.modulos.items[r].compra).toFixed(3),dimensiones=" ("+i+" x "+n+")"):(compra=parseFloat(s*e.modulos.items[r].compra).toFixed(3),dimensiones=""),venta=parseFloat(parseFloat(compra)*(l/100)+parseFloat(compra)).toFixed(2),e.listado.push({index:t+"M",nombre:e.modulos.items[r].nombre+dimensiones,linea:0,cantidad:s,compraU:e.modulos.items[r].compra,ventaU:e.modulos.items[r].venta,compraT:compra,ventaT:venta,tipo:"item",id:e.modulos.items[r].id,ancho:i,largo:n}),t++}for(var r=e.modulos.modulos.length-1;r>=0;r--){var s=e.modulos.modulos[r].cantidad,l=e.porciento;compra=parseFloat(s*e.modulos.modulos[r].compra).toFixed(3),venta=parseFloat(parseFloat(compra)*(l/100)+parseFloat(compra)).toFixed(2),e.listado.push({index:t+"M",nombre:e.modulos.modulos[r].nombre,linea:0,cantidad:s,compraU:e.modulos.modulos[r].compra,ventaU:e.modulos.modulos[r].venta,compraT:compra,ventaT:venta,tipo:"modulo",id:e.modulos.modulos[r].id}),t++}},t.$on("eliminarLista",function(o,a){for(var t=e.listado.length-1;t>=0;t--)e.listado[t].index===a&&e.listado.splice(t,1)})}]),angular.module("RDash").controller("Notificaciones",["$scope","$http","$modal","$rootScope","$location","$window",function(e,o,a,t,r,i){e.nombreN="",e.descripcionN="",e.editar=!1,e.notificaciones=[],e.notif=!0,e.idP="",e.dtInicio=new Date,e.idActualizar="",e.logueado=!1,t.hayNotif=!1,e.verificarPrivilegio=function(){"undefined"!=typeof i.sessionStorage.gNot&&(e.logueado=i.sessionStorage.gNot),e.logueado||r.path("/Sesion")},e.buscarNotificaciones=function(){o.get("model/buscarNotif.php?id="+i.sessionStorage.nameUser).then(function(o){e.notificaciones=o.data})},e.buscarNotificaciones(),e.notifEditar=function(o){e.editar=!0;for(var a=e.notificaciones.length-1;a>=0;a--)if(e.notificaciones[a].id===o){e.nombreN=e.notificaciones[a].nombre,e.descripcionN=e.notificaciones[a].descripcion,e.dtInicio=new Date(e.notificaciones[a].fecha),e.dtInicio.setMinutes(e.dtInicio.getMinutes()+e.dtInicio.getTimezoneOffset()),e.editar=!0,e.idActualizar=e.notificaciones[a].id,e.notificaciones.splice(a,1);break}},e.guardar=function(){var a={nombre:e.nombreN,desc:e.descripcionN,fecha:new Date(e.dtInicio),usuario:i.sessionStorage.nameUser,id:e.idActualizar};e.editar?o.post("model/actualizarNotificacion.php",a).success(function(o){"OK"===o?(e.openModal("sm","Actualizada correctamente la notificación.","ok.html"),e.nombreN="",e.descripcionN="",e.dtInicio=new Date,e.formN.$pristine=!0,e.buscarNotificaciones(),e.editar=!1,e.idActualizar=""):e.openModal("sm",o,"error.html")}).error(function(o){e.openModal("xs",o,"error.html")}):o.post("model/insertarNotificacion.php",a).success(function(o){"OK"===o?(e.openModal("sm","Insertada correctamente la notificación.","ok.html"),e.nombreN="",e.descripcionN="",e.dtInicio=new Date,e.formN.$pristine=!0,e.buscarNotificaciones()):e.openModal("sm",o,"error.html")}).error(function(o){e.openModal("xs",o,"error.html")})},e.openModal=function(e,o,t){a.open({templateUrl:t,controller:"myModalController",size:e,resolve:{Items:function(){return o}}})},t.$on("notif",function(a,t){o.post("model/eliminarNotificacion.php",t).success(function(o){"OK"===o?(e.openModal("sm","Eliminada correctamente la notificación.","ok.html"),e.buscarNotificaciones()):e.openModal("sm",o,"error.html")})})}]),angular.module("RDash").controller("Usuario",["$rootScope","$scope","$modal","$http","$location","$window",function(e,o,a,t,r,i){o.usuarios=[],o.nombreU="",o.descripcionU="",o.passU="",o.passRepU="",o.uIndex=0,o.editando=!1,o.nombreActualizar="",o.rol=[],o.logueado=!1,o.verificarPrivilegio=function(){"undefined"!=typeof i.sessionStorage.gUs&&(o.logueado=i.sessionStorage.gUs),o.logueado||r.path("/Sesion")},o.buscarRoles=function(){o.rol.push({id:0,nombre:"--------"},{id:1,nombre:"Cliente"},{id:2,nombre:"Administrador"}),o.rol.selected=0},o.buscarRoles(),o.buscarUsuarios=function(){o.usuarios=[{index:1,nombre:"Cliente",descripcion:"Cliente 1",rolN:"Cliente",rolI:1}],o.uIndex=o.usuarios.length},o.buscarUsuarios(),o.guardar=function(){var e={id:o.nombreActualizar,nombre:o.nombreU,password:o.passU,desc:o.descripcionU,idRol:o.rol.selected};o.editando?t.post("model/actualizarUsuario.php",e).success(function(e){"OK"===e?(o.openModal("sm","Actualizado correctamente el usuario.","ok.html"),o.buscarUsuarios(),o.nombreU="",o.descripcionU="",o.passU="",o.passRepU="",o.rol.selected=0,o.formU.$pristine=!0,o.editando=!1,o.nombreActualizar=""):o.openModal("sm",e,"error.html")}).error(function(e){o.openModal("xs",e,"error.html")}):t.post("model/insertarUsuario.php",e).success(function(e){"OK"===e?(o.openModal("sm","Insertado correctamente el usuario.","ok.html"),o.buscarUsuarios(),o.nombreU="",o.descripcionU="",o.passU="",o.passRepU="",o.rol.selected=0,o.formU.$pristine=!0):o.openModal("sm",e,"error.html")}).error(function(e){o.openModal("xs",e,"error.html")})},o.usuariosEditar=function(e){for(var a=o.usuarios.length-1;a>=0;a--)o.usuarios[a].index===e&&(o.nombreU=o.usuarios[a].nombre,o.descripcionU=o.usuarios[a].descripcion,o.rol.selected=o.usuarios[a].rolI,o.passU="",o.passRepU="",o.usuarios.splice(a,1),o.editando=!0,o.nombreActualizar=o.nombreU)},o.openModal=function(e,o,t){a.open({templateUrl:t,controller:"myModalController",size:e,resolve:{Items:function(){return o}}})},e.$on("user",function(e,a){for(var r="",i=o.usuarios.length-1;i>=0;i--)if(o.usuarios[i].index===a){r={id:o.usuarios[i].nombre};break}t.post("model/eliminarUsuario.php",r).success(function(e){"OK"===e?(o.openModal("sm","Eliminado correctamente el usuario.","ok.html"),o.buscarUsuarios()):o.openModal("sm",e,"error.html")})})}]),angular.module("RDash").controller("Roles",["$rootScope","$scope","$modal","$http","$location","$window",function(e,o,a,t,r,i){o.listado=[],o.roles=[],o.nombreR="",o.descripcionR="",o.uIndex=0,o.editando=!1,o.nombreActualizar="",o.logueado=!1,o.verificarPrivilegio=function(){"undefined"!=typeof i.sessionStorage.gRol&&(o.logueado=i.sessionStorage.gRol),o.logueado||r.path("/Sesion")},o.buscarRoles=function(){var e="Nuevo Proyecto, Nuevo Módulo",a=[{index:1,id:1,nombre:"Nuevo Proyecto"},{index:2,id:2,nombre:"Nuevo Módulo"}];o.roles=[{index:1,nombre:"Cliente",descripcion:"Ejemplo de Rol",funcionalidades:e,funcListado:a}],o.uIndex=o.roles.length},o.buscarRoles(),o.guardar=function(){var e={id:o.nombreActualizar,nombre:o.nombreR,desc:o.descripcionR,funcListado:o.listado};o.editando?t.post("model/actualizarRol.php",e).success(function(e){"OK"===e?(o.openModal("sm","Actualizado correctamente el rol.","ok.html"),o.buscarRoles(),o.nombreR="",o.descripcionR="",o.formR.$pristine=!0,o.editando=!1,o.nombreActualizar="",o.listado=[]):o.openModal("sm",e,"error.html")}).error(function(e){o.openModal("xs",e,"error.html")}):t.post("model/insertarRol.php",e).success(function(e){"OK"===e?(o.openModal("sm","Insertado correctamente el rol.","ok.html"),o.buscarRoles(),o.nombreR="",o.descripcionR="",o.formR.$pristine=!0,o.listado=[]):o.openModal("sm",e,"error.html")}).error(function(e){o.openModal("xs",e,"error.html")})},o.usuarioEditar=function(e){for(var a=o.roles.length-1;a>=0;a--)o.roles[a].index===e&&(o.nombreR=o.roles[a].nombre,o.descripcionR=o.roles[a].descripcion,o.listado=o.roles[a].funcListado,o.roles.splice(a,1),o.editando=!0,o.nombreActualizar=o.nombreR)},o.openModal=function(e,o,t){a.open({templateUrl:t,controller:"myModalController",size:e,resolve:{Items:function(){return o}}})},e.$on("eliminarLista",function(e,a){for(var t=o.listado.length-1;t>=0;t--)o.listado[t].index===a&&o.listado.splice(t,1)}),e.$on("rol",function(e,a){for(var r="",i=o.roles.length-1;i>=0;i--)if(o.roles[i].index===a){r={id:o.roles[i].nombre};break}t.post("model/eliminarRol.php",r).success(function(e){"OK"===e?(o.openModal("sm","Eliminado correctamente el rol.","ok.html"),o.buscarRoles()):o.openModal("sm",e,"error.html")})})}]),angular.module("RDash").controller("Sesion",["$scope","$http","$modal","$location","$window","$rootScope",function(e,o,a,t,r,i){e.nombreS="",e.passS="",r.sessionStorage.nameUser="",r.sessionStorage.idUser="",r.sessionStorage.passUser="",r.sessionStorage.descUser="",r.sessionStorage.idRolUser="",r.sessionStorage.nameRolUser="",r.sessionStorage.funcUser="",r.sessionStorage.nProy=!1,r.sessionStorage.gProy=!1,r.sessionStorage.nLin=!1,r.sessionStorage.gLin=!1,r.sessionStorage.nIt=!1,r.sessionStorage.gIt=!1,r.sessionStorage.nTIt=!1,r.sessionStorage.gTIt=!1,r.sessionStorage.nMod=!1,r.sessionStorage.gMod=!1,r.sessionStorage.Pro=!1,r.sessionStorage.Fac=!1,r.sessionStorage.vFac=!1,r.sessionStorage.mPer=!1,r.sessionStorage.gNot=!1,r.sessionStorage.gUs=!1,r.sessionStorage.gRol=!1,e.buscarDatosUsuario=function(){o.get("model/buscarDatosUsuario.php?id="+e.nombreS).then(function(o){i.nameUser=e.nombreS,r.sessionStorage.nameUser=e.nombreS,r.sessionStorage.passUser=e.passS,r.sessionStorage.idUser=o.data[0].idUser,r.sessionStorage.descUser=o.data[0].descripcion,r.sessionStorage.idRolUser=o.data[0].idRol,r.sessionStorage.nameRolUser=o.data[0].nameRol,r.sessionStorage.funcUser=o.data[0].funcionalidades;for(var a=0;a<o.data[0].funcionalidades.length;a++)switch(o.data[0].funcionalidades[a].nombre){case"Nuevo Proyecto":r.sessionStorage.nProy=!0;break;case"Gestionar Proyecto":r.sessionStorage.gProy=!0;break;case"Nueva Línea":r.sessionStorage.nLin=!0;break;case"Gestionar Línea":r.sessionStorage.gLin=!0;break;case"Nuevo Item":r.sessionStorage.nIt=!0;break;case"Gestionar Item":r.sessionStorage.gIt=!0;break;case"Nuevo Tipo de Item":r.sessionStorage.nTIt=!0;break;case"Gestionar Tipo de Item":r.sessionStorage.gTIt=!0;break;case"Nuevo Módulo":r.sessionStorage.nMod=!0;break;case"Gestionar Módulo":r.sessionStorage.gMod=!0;break;case"Proformar":r.sessionStorage.Pro=!0;break;case"Facturar":r.sessionStorage.Fac=!0;break;case"Ver Facturas":r.sessionStorage.vFac=!0;break;case"Mi Perfil":r.sessionStorage.mPer=!0;break;case"Gestionar Notificaciones":r.sessionStorage.gNot=!0;break;case"Gestionar Usuarios":r.sessionStorage.gUs=!0;break;case"Gestionar Roles":r.sessionStorage.gRol=!0}t.path("/inicio")})},e.guardar=function(){var a={id:e.nombreS,pass:e.passS};o.post("model/iniciarSesion.php",a).success(function(o){if("OK"===o)e.buscarDatosUsuario();else{var a="";a="pass"===o?"Error, las contraseñas no coinciden.":"Error, el usuario no existe.",e.openModal("sm",a,"error.html")}})},e.openModal=function(e,o,t){a.open({templateUrl:t,controller:"myModalController",size:e,resolve:{Items:function(){return o}}})}}]),angular.module("RDash").controller("gProyecto",["$rootScope","$scope","$modal","$http","$location","$window",function(e,o,a,t,r,i){o.editar=!1,o.proyectos=[],o.gproyecto=!0,o.idP="",o.logueado=!1,o.verificarPrivilegio=function(){"undefined"!=typeof i.sessionStorage.gProy&&(o.logueado=i.sessionStorage.gProy),o.logueado||r.path("/Sesion")},o.buscarProyectos=function(){var e=[{nombre:"Modulo1",id:1,cantidad:2,compra:10,venta:15,linea:1,oferta:12,ofertaT:24,ancho:0,largo:0}];o.proyectos=[{numeroAnno:"2016",nombre:"Proyecto1",id:1,descripcion:"Ejemplo de proyecto",numero:1,anno:"2016",compra:10,venta:15,oferta:12,inicio:"2016-01-02",entrega:"2016-02-25",linea:1,cliente:1,nombreC:"Cliente1",direccion:"Mi direccion",ruc:"12345",telefono:"67890",email:"asd@asd.asd",modulos:e}]},o.buscarProyectos(),o.proyectoEditar=function(e){o.editar=!0,o.buscarClientes();for(var a=o.proyectos.length-1;a>=0;a--)if(o.proyectos[a].id===e){o.nombreP=o.proyectos[a].nombre,o.idP=o.proyectos[a].id,o.numero=o.proyectos[a].numero,o.anno=o.proyectos[a].anno,o.numeroP="0".repeat(3-o.numero.toString.length)+o.numero+"-"+o.anno,o.descripcionP=o.proyectos[a].descripcion,o.rucC=o.proyectos[a].ruc,o.nombreC=o.proyectos[a].nombreC,o.direccionC=o.proyectos[a].direccion,o.idCBD=o.proyectos[a].cliente,o.telefonoC=o.proyectos[a].telefono,o.emailC=o.proyectos[a].email,o.dtInicio=new Date(o.proyectos[a].inicio),o.dtInicio.setMinutes(o.dtInicio.getMinutes()+o.dtInicio.getTimezoneOffset()),o.dtEntrega=new Date(o.proyectos[a].entrega),o.dtEntrega.setMinutes(o.dtEntrega.getMinutes()+o.dtEntrega.getTimezoneOffset()),o.lineas.selected=o.proyectos[a].linea,o.lectura=!0,o.listado=[];for(var t=0,r=o.proyectos[a].modulos.length-1;r>=0;r--){var i=o.proyectos[a].modulos[r].cantidad,n=o.proyectos[a].modulos[r].linea,s=0,l=0,d=!0;if(o.proyectos[a].modulos[r].ancho>0&&o.proyectos[a].modulos[r].largo>0){d=!1;for(var c=o.proyectos[a].modulos[r].ancho*o.proyectos[a].modulos[r].largo,p=0;p<o.lineas[n].items.length;p++)1===o.lineas[n].items[p].dimension?(s=parseFloat(parseFloat(s)+parseFloat(o.lineas[n].items[p].cantidad*c*o.lineas[n].items[p].compra)).toFixed(3),l=parseFloat(parseFloat(l)+parseFloat(o.lineas[n].items[p].cantidad*c*o.lineas[n].items[p].venta)).toFixed(2)):(s=parseFloat(parseFloat(s)+parseFloat(o.lineas[n].items[p].cantidad*o.lineas[n].items[p].compra)).toFixed(3),l=parseFloat(parseFloat(l)+parseFloat(o.lineas[n].items[p].cantidad*o.lineas[n].items[p].venta)).toFixed(2))}else s=o.lineas[n].precioC,l=o.lineas[n].precioV;var u=parseFloat(parseFloat(i*s)+parseFloat(i*o.proyectos[a].modulos[r].compra)).toFixed(3),m=parseFloat(parseFloat(i*l)+parseFloat(i*o.proyectos[a].modulos[r].venta)).toFixed(2);o.listado.push({index:t,nombre:o.proyectos[a].modulos[r].nombre,linea:n,cantidad:i,compraU:o.proyectos[a].modulos[r].compra,ventaU:o.proyectos[a].modulos[r].venta,compraT:u,ventaT:m,tipo:"modulo",ofertaU:o.proyectos[a].modulos[r].oferta,ofertaT:o.proyectos[a].modulos[r].ofertaT,anchoL:o.proyectos[a].modulos[r].ancho,largoL:o.proyectos[a].modulos[r].largo,precioC:s,precioV:l,id:o.proyectos[a].modulos[r].id,habilitarD:d}),"undefined"==typeof o.tlineas[t]&&o.tlineas.push({id:0,nombre:"---------",precioC:0,precioV:0}),o.tlineas[t].selected=n,t++}break}},o.openModal=function(e,o,t){a.open({templateUrl:t,controller:"myModalController",size:e,resolve:{Items:function(){return o}}})},e.$on("proyecto",function(e,a){t.post("model/eliminarProyecto.php",a).success(function(e){"OK"===e?(o.openModal("sm","Eliminado correctamente el proyecto.","ok.html"),o.buscarProyectos(),o.editar=!1):o.openModal("sm",e,"error.html")})}),o.listado=[],o.clientes=[],o.rucs=[],o.errorP=!1,o.lectura=!1,o.nombreP="",o.numeroP="",o.numero="",o.anno="",o.tratarDimension=function(e){if(e.indexOf(".")>0){var o=e.substring(0,e.indexOf(".")),a=e.substring(e.indexOf("."));e=parseInt(o).toString()+a}else e.indexOf(".")<0?e=parseInt(e).toString():"."===e.substr(0,1)&&(e="0"+e);if(e>0)if(e.indexOf(".")>-1){var t=parseInt(e.length)-e.indexOf(".")-1;2-t>0&&(e+="0".repeat(2-t))}else e+=".00";return e},o.buscarClientes=function(){t.get("model/buscarClientes.php").then(function(e){o.clientes=e.data,o.rucs=[];for(var a=0;a<e.data.length;a++)o.rucs.push(e.data[a].ruc)})},o.descripcionP="",o.rucC="",o.nombreC="",o.direccionC="",o.telefonoC="",o.emailC="",o.idCBD="",o.dtInicio=new Date,o.dtEntrega=new Date,o.lineas=[{id:0,nombre:"---------",precioC:0,precioV:0}],o.lineas.selected=0,o.tlineas=[{id:0,nombre:"---------",precioC:0,precioV:0}],o.buscarLineas=function(){var e=[{nombre:"Puerta",id:1,cantidad:3,compra:10,venta:15},{nombre:"Mano de Obra",id:2,cantidad:1,compra:20,venta:25}];o.lineas.push({id:1,nombre:"Linea1",precioC:20,precioV:25,items:e}),e=[{nombre:"Enganche",id:1,cantidad:6,compra:5,venta:8},{nombre:"Mano de Obra",id:2,cantidad:1,compra:10,venta:15}],o.lineas.push({id:2,nombre:"Linea2",precioC:15,precioV:18,items:e})},o.buscarLineas(),o.updateDimensionL=function(e,a,t){for(var r=0;r<o.listado.length;r++)if(o.listado[r].index===a){a=r;break}"A"===t&&(o.listado[a].anchoL=o.tratarDimension(o.listado[a].anchoL)),"L"===t&&(o.listado[a].largoL=o.tratarDimension(o.listado[a].largoL));for(var i=0,n=0,s=o.listado[a].anchoL*o.listado[a].largoL,l=0;l<o.lineas[e].items.length;l++)1===o.lineas[e].items[l].dimension?(i=parseFloat(parseFloat(i)+parseFloat(o.lineas[e].items[l].cantidad*s*o.lineas[e].items[l].compra)).toFixed(3),n=parseFloat(parseFloat(n)+parseFloat(o.lineas[e].items[l].cantidad*s*o.lineas[e].items[l].venta)).toFixed(2)):(i=parseFloat(parseFloat(i)+parseFloat(o.lineas[e].items[l].cantidad*o.lineas[e].items[l].compra)).toFixed(3),n=parseFloat(parseFloat(n)+parseFloat(o.lineas[e].items[l].cantidad*o.lineas[e].items[l].venta)).toFixed(2));o.listado[a].compraT=parseFloat(parseFloat(o.listado[a].cantidad*i)+parseFloat(o.listado[a].cantidad*o.listado[a].compraU)).toFixed(3),o.listado[a].ventaT=parseFloat(parseFloat(o.listado[a].cantidad*n)+parseFloat(o.listado[a].cantidad*o.listado[a].ventaU)).toFixed(2),o.listado[a].ofertaT=parseFloat(parseFloat(o.listado[a].cantidad*n)+parseFloat(o.listado[a].cantidad*o.listado[a].ofertaU)).toFixed(2),o.listado[a].precioC=i,o.listado[a].precioV=n},o.actualizarLineas=function(){for(var e=0,a=0;a<o.lineas.length;a++)if(o.lineas[a].id===o.lineas.selected){e=a;break}for(var a=0;a<o.tlineas.length;a++)o.tlineas[a].selected=o.lineas[e].id;for(var a=0;a<o.listado.length;a++){o.listado[a].linea=e;var t=!1;if(e>0)for(var r=0;r<o.lineas[e].items.length;r++)if(1===o.lineas[e].items[r].dimension){t=!0;break}if(t){o.listado[a].habilitarD=!1;for(var i=0,n=0,s=o.listado[a].anchoL*o.listado[a].largoL,r=0;r<o.lineas[e].items.length;r++)1===o.lineas[e].items[r].dimension?(i=parseFloat(parseFloat(i)+parseFloat(o.lineas[e].items[r].cantidad*s*o.lineas[e].items[r].compra)).toFixed(3),n=parseFloat(parseFloat(n)+parseFloat(o.lineas[e].items[r].cantidad*s*o.lineas[e].items[r].venta)).toFixed(2)):(i=parseFloat(parseFloat(i)+parseFloat(o.lineas[e].items[r].cantidad*o.lineas[e].items[r].compra)).toFixed(3),n=parseFloat(parseFloat(n)+parseFloat(o.lineas[e].items[r].cantidad*o.lineas[e].items[r].venta)).toFixed(2));o.listado[a].compraT=parseFloat(parseFloat(o.listado[a].cantidad*i)+parseFloat(o.listado[a].cantidad*o.listado[a].compraU)).toFixed(3),o.listado[a].ventaT=parseFloat(parseFloat(o.listado[a].cantidad*n)+parseFloat(o.listado[a].cantidad*o.listado[a].ventaU)).toFixed(2),o.listado[a].ofertaT=parseFloat(parseFloat(o.listado[a].cantidad*n)+parseFloat(o.listado[a].cantidad*o.listado[a].ofertaU)).toFixed(2),o.listado[a].precioC=i,o.listado[a].precioV=n}else o.listado[a].compraT=parseFloat(parseFloat(o.listado[a].cantidad*o.lineas[e].precioC)+parseFloat(o.listado[a].cantidad*o.listado[a].compraU)).toFixed(3),o.listado[a].ventaT=parseFloat(parseFloat(o.listado[a].cantidad*o.lineas[e].precioV)+parseFloat(o.listado[a].cantidad*o.listado[a].ventaU)).toFixed(2),o.listado[a].ofertaT=parseFloat(parseFloat(o.listado[a].cantidad*o.lineas[e].precioV)+parseFloat(o.listado[a].cantidad*o.listado[a].ofertaU)).toFixed(2),o.listado[a].precioC=o.lineas[e].precioC,o.listado[a].precioV=o.lineas[e].precioV,o.listado[a].anchoL=0,o.listado[a].largoL=0,o.listado[a].habilitarD=!0}},o.costo=function(){for(var e=0,a=o.listado.length-1;a>=0;a--)e+=parseFloat(o.listado[a].compraT);return parseFloat(e).toFixed(3)},o.venta=function(){for(var e=0,a=o.listado.length-1;a>=0;a--)e+=parseFloat(o.listado[a].ventaT);return parseFloat(e).toFixed(2)},o.oferta=function(){for(var e=0,a=o.listado.length-1;a>=0;a--)e+=parseFloat(o.listado[a].ofertaT);return parseFloat(e).toFixed(2)},o.actualizarCliente=function(){for(var e=!0,a=0;a<o.clientes.length;a++)if(o.clientes[a].ruc===o.rucC){o.nombreC=o.clientes[a].nombre,o.telefonoC=o.clientes[a].telefono,o.emailC=o.clientes[a].correo,o.direccionC=o.clientes[a].direccion,o.idCBD=o.clientes[a].id,o.lectura=!0,e=!1;break}e&&(o.nombreC="",o.telefonoC="",o.emailC="",o.direccionC="",o.idCBD="",o.lectura=!1)},o.actualizar=function(){o.errorListado=[],o.errorIndex=0;var e=!1,a=/^([a-zA-Z- -ñÑ])+$/,r=/^([0-9])*$/,i=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/,n=/^\d{0,9}(\.\d{1,2})?$/;""===o.nombreP&&(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar un nombre para el proyecto."}),o.errorIndex++),""===o.descripcionP&&(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar una descripción para el proyecto."}),o.errorIndex++),(o.dtInicio.toLocaleDateString()===o.dtEntrega.toLocaleDateString()||new Date(o.dtInicio)>new Date(o.dtEntrega))&&(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe escoger una fecha de entrega posterior a la fecha de inicio."}),o.errorIndex++),""===o.rucC?(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar una identificación para el cliente."}),o.errorIndex++):r.test(o.rucC)||(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar un número de identificación válido para el cliente."}),o.errorIndex++),""===o.nombreC?(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar el nombre del cliente."}),o.errorIndex++):a.test(o.nombreC)||(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar un nombre válido para el cliente."}),o.errorIndex++),""===o.direccionC&&(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar la dirección del cliente."}),o.errorIndex++),""===o.telefonoC?(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar un número de teléfono del cliente."}),o.errorIndex++):r.test(o.telefonoC)||(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar un número de teléfono válido para el cliente."}),o.errorIndex++),""===o.emailC?(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar un correo electrónico del cliente."}),o.errorIndex++):i.test(o.emailC)||(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar un correo electrónico válido para el cliente."}),o.errorIndex++),0===o.listado.length&&(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe ser escogido al menos un módulo para utilizar en el proyecto."}),o.errorIndex++);for(var s=0;s<o.listado.length;s++){var l=!1;if(o.listado[s].linea>0){for(var d=0;d<o.lineas[o.listado[s].linea].items.length;d++)if(1===o.lineas[o.listado[s].linea].items[d].dimension){l=!0;break}l&&(r.test(o.listado[s].anchoL)&&r.test(o.listado[s].largoL)||n.test(o.listado[s].anchoL)&&n.test(o.listado[s].largoL)?(0===parseFloat(o.listado[s].anchoL)||0===parseFloat(o.listado[s].largoL))&&(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar las dimensiones para la línea en el módulo "+o.listado[s].nombre+"."}),o.errorIndex++):(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Las dimensiones especificadas para la línea no son correctas en el módulo "+o.listado[s].nombre+"."}),o.errorIndex++))}}for(var s=0;s<o.listado.length;s++)r.test(o.listado[s].ofertaT)||n.test(o.listado[s].ofertaT)||(e=!0,o.errorListado.push({index:o.errorIndex,texto:"La oferta especificada no es correcta en el módulo "+o.listado[s].nombre+"."}),o.errorIndex++);if(e)o.errorP=!0;else{for(var s=0;s<o.listado.length;s++)o.listado[s].anchoL>0&&(o.listado[s].anchoL=o.tratarDimension(o.listado[s].anchoL)),o.listado[s].largoL>0&&(o.listado[s].largoL=o.tratarDimension(o.listado[s].largoL));o.errorP=!1;for(var c=[],s=0;s<o.listado.length;s++){for(var l=!0,d=0;d<c.length;d++)if(c[d].id===o.listado[s].id&&c[d].linea===o.listado[s].linea&&c[d].anchoL===o.listado[s].anchoL&&c[d].largoL===o.listado[s].largoL){c[d].cantidad=parseInt(c[d].cantidad)+parseInt(o.listado[s].cantidad),l=!1;break}l&&c.push(o.listado[s])}var p="false";o.lectura&&(p="true");var u={idP:o.idP,nombreP:o.nombreP,nombreC:o.nombreC,ruc:o.rucC,dir:o.direccionC,tel:o.telefonoC,correo:o.emailC,numero:o.numero,anno:o.anno,desc:o.descripcionP,finicio:new Date(o.dtInicio),fentrega:new Date(o.dtEntrega),linea:o.lineas[o.lineas.selected].id,listado:c,compra:o.costo(),venta:o.venta(),oferta:o.oferta(),lectura:p,idC:o.idCBD};t.post("model/actualizarProyecto.php",u).success(function(e){"OK"===e?(o.openModal("sm","Actualizado correctamente el proyecto.","ok.html"),o.buscarProyectos(),o.editar=!1):o.openModal("sm",e,"error.html")}).error(function(e){o.openModal("xs",e,"error.html")})}},e.$on("eliminarLista",function(e,a){for(var t=o.listado.length-1;t>=0;t--)o.listado[t].index===a&&o.listado.splice(t,1)})}]),angular.module("RDash").controller("gItem",["$rootScope","$scope","$modal","$http","$location","$window",function(e,o,a,t,r,i){o.editar=!1,o.idI="",o.logueado=!1,o.verificarPrivilegio=function(){"undefined"!=typeof i.sessionStorage.gIt&&(o.logueado=i.sessionStorage.gIt),o.logueado||r.path("/Sesion")},o.datosCargar=[{id:"",nombre:"",codigo:"",desc:"",precio:"",tipo:"",dimension:"",campos:[]}],o.buscarItems=function(){
o.items=[{id:"1",nombre:"Puerta",codigo:"PRT1",descripcion:"Puerta del tipo 1",precio_compra:"10",precio_venta:13,nombre_tipo_item:"Madera",idT:"1",dimension:1}],o.items.push({id:"2",nombre:"Engache",codigo:"ENG",descripcion:"Enganche para puerta",precio_compra:"5",precio_venta:8,nombre_tipo_item:"Tornillo",idT:"2",dimension:0})},o.buscarItems(),o.itemEditar=function(e){o.editar=!0,o.tipos=[{id:0,nombre:"---------"}],o.buscarTipos(),o.dinamicos=[],o.tipos.selected=0;for(var a=o.items.length-1;a>=0;a--)if(o.items[a].id===e){o.datosCargar[0].id=e,o.datosCargar[0].nombre=o.items[a].nombre,o.datosCargar[0].codigo=o.items[a].codigo,o.datosCargar[0].desc=o.items[a].descripcion,o.datosCargar[0].precio=o.items[a].precio_compra,o.datosCargar[0].tipo=o.items[a].idT,1===o.items[a].dimension?o.datosCargar[0].dimension=!0:o.datosCargar[0].dimension=!1,"1"===o.items[a].idT?o.datosCargar[0].campos=[{idC:1,valor:"Doble",nombre:"Caras",tipo:"texto"}]:o.datosCargar[0].campos=[{idC:1,valor:"0.5",nombre:"Grosor",tipo:"decimal"},{idC:2,valor:"1",nombre:"Longitud",tipo:"decimal"}],o.actualizarDatos();break}},o.actualizarDatos=function(){o.nombreI=o.datosCargar[0].nombre,o.idI=o.datosCargar[0].id,o.codigoI=o.datosCargar[0].codigo,o.descripcionI=o.datosCargar[0].desc,o.compraI=o.datosCargar[0].precio,o.tipos.selected=o.datosCargar[0].tipo,o.activo=o.datosCargar[0].dimension;for(var e="",a=0;a<o.datosCargar[0].campos.length;a++){switch(o.datosCargar[0].campos[a].tipo){case"texto":e=o.patronLetras;break;case"entero":e=o.patronEntero;break;case"decimal":e=o.patronDecimal}var t=o.datosCargar[0].campos[a].nombre+o.idI;o.dinamicos.push({nombre:o.datosCargar[0].campos[a].nombre,tipo:e,identificador:t,valor:o.datosCargar[0].campos[a].valor,id:o.datosCargar[0].campos[a].idC})}},o.openModal=function(e,o,t){a.open({templateUrl:t,controller:"myModalController",size:e,resolve:{Items:function(){return o}}})},e.$on("item",function(e,a){t.post("model/eliminarItem.php",a).success(function(e){if("OK"===e)o.openModal("sm","Eliminado correctamente el item.","ok.html"),o.buscarItems(),o.editar=!1;else{var a="";a="linea"===e?"No se puede eliminar el item ya que se encuentra asociado a una línea.":"No se puede eliminar el item ya que se encuentra asociado a un módulo.",o.openModal("xs",a,"error.html"),o.editar=!1}})}),o.verGItems=function(){o.openModal("lg",o.items,"lItems.html")},o.patronEntero=/^([0-9])*$/,o.patronDecimal=/^\d{0,9}(\.\d{1,2})?$/,o.patronLetras=/^([a-zA-Z- -ñÑ])+$/,o.tipos=[{id:0,nombre:"---------"}],o.activo=!1,o.dinamicos=[],o.buscarTipos=function(){var e=[];e.push({nombre:"Caras",tipo:o.patronLetras,identificador:"1",valor:"",id:"1"}),o.tipos.push({id:"1",nombre:"Madera",campos:e}),e=[],e.push({nombre:"Grosor",tipo:o.patronDecimal,identificador:"2",valor:"",id:"2"}),e.push({nombre:"Longitud",tipo:o.patronDecimal,identificador:"3",valor:"",id:"3"}),o.tipos.push({id:"2",nombre:"Tornillo",campos:e})},o.nombre="",o.nombreI="",o.codigoI="",o.descripcionI="",o.compraI="",o.ventaI="",o.porciento="",o.buscarPorciento=function(){o.porciento=30},o.buscarPorciento(),o.identificador=o.tipos[0].nombre+o.tipos[0].id,o.nuevoItem=[],o.$watch(function(){o.ventaI=parseFloat(parseFloat(o.compraI)*(o.porciento/100)+parseFloat(o.compraI)).toFixed(2)}),o.actualizarNombres=function(){for(var e=0;e<o.tipos.length;e++)if(o.tipos[e].id===o.tipos.selected){o.dinamicos=o.tipos[e].campos;break}},o.actualizar=function(){var e="false";o.activo&&(e="true"),o.nuevoItem=[{identificador:"nombre",valor:o.nombreI},{identificador:"codigo",valor:o.codigoI},{identificador:"descripcion",valor:o.descripcionI},{identificador:"compra",valor:o.compraI},{identificador:"venta",valor:o.ventaI},{identificador:"dimension",valor:e},{identificador:"id",valor:o.idI}];for(var a=o.tipos.length-1;a>=0;a--)if(o.tipos[a].id===o.tipos.selected){o.nuevoItem.push({identificador:"tipo",valor:o.tipos.selected});for(var r=o.dinamicos.length-1;r>=0;r--)o.nuevoItem.push({identificador:o.dinamicos[r].id,valor:o.dinamicos[r].valor,id:o.dinamicos[r].identificador})}t.post("model/actualizarItem.php",o.nuevoItem).success(function(e){"OK"===e?(o.openModal("sm","Actualizado correctamente el item.","ok.html"),o.buscarItems(),o.editar=!1,o.dinamicos=[]):o.openModal("sm",e,"error.html")}).error(function(e){o.openModal("xs",e,"error.html")})}}]),angular.module("RDash").controller("gTipoItem",["$rootScope","$scope","$modal","$http","$location","$window",function(e,o,a,t,r,i){o.editar=!1,o.idTI="",o.logueado=!1,o.verificarPrivilegio=function(){"undefined"!=typeof i.sessionStorage.gTIt&&(o.logueado=i.sessionStorage.gTIt),o.logueado||r.path("/Sesion")},o.buscarTipoItems=function(){o.tipoItem=[{id:"1",nombre:"Madera",campos:[{id:"1",nombre:"Caras"}]},{id:"2",nombre:"Tornillo",campos:[{id:"1",nombre:"Grosor"},{id:"2",nombre:"Longitud"}]}]},o.buscarTipoItems(),o.tipoItemEditar=function(e){o.editar=!0,o.tiposItem=[],o.tiIndex=0;for(var a=o.tipoItem.length-1;a>=0;a--)if(o.tipoItem[a].id===e){o.nombreTI=o.tipoItem[a].nombre,o.idTI=o.tipoItem[a].id;for(var t=o.tipoItem[a].campos.length-1;t>=0;t--){var r="",i="";switch(o.tipoItem[a].campos[t].tipo){case"texto":r=1,i="Texto";break;case"entero":r=2,i="Número entero";break;case"decimal":r=3,i="Número decimal"}o.tiposItem.push({index:o.tipoItem[a].campos[t].id,nombre:o.tipoItem[a].campos[t].nombre,tipoN:i,tipoI:r,bd:"true"})}break}},o.openModal=function(e,o,t){a.open({templateUrl:t,controller:"myModalController",size:e,resolve:{Items:function(){return o}}})},e.$on("tipo",function(e,a){t.post("model/eliminarTipoItem.php",a).success(function(e){"True"===e.sucess?(o.openModal("sm","Eliminado el tipo de item.","ok.html"),o.buscarTipoItems(),o.editar=!1):"False"===e.sucess?o.openModal("xs",e.items,"items.html"):o.openModal("sm",e,"error.html")})}),o.tiposItem=[],o.tiIndex=0,o.tiposCTI=[{id:0,nombre:"--------------"},{id:1,nombre:"Texto"},{id:2,nombre:"Número entero"},{id:3,nombre:"Número decimal"}],o.tiposCTI.selected=0,o.nombreTI="",o.nombreCTI="",o.actualizar=function(){var e={id:o.idTI,nombre:o.nombreTI,campos:o.tiposItem};t.post("model/actualizarTipoItem.php",e).success(function(e){"OK"===e?(o.openModal("sm","Actualizado el tipo de item.","ok.html"),o.buscarTipoItems(),o.editar=!1):"OK2"===e?(o.openModal("sm","Actualizado el tipo de item pero no sus campos al tener asociado items","ok.html"),o.buscarTipoItems(),o.editar=!1):o.openModal("xs",e,"error.html")}).error(function(e){o.openModal("xs",e,"error.html")})},o.adicionar=function(e){for(var a=!0,t=o.tiposItem.length-1;t>=0;t--)if(o.tiposItem[t].nombre===o.nombreCTI){o.openModal("xs","No puede tener dos campos con el mismo nombre.","error.html"),a=!1;break}a&&(o.tiposItem.push({index:o.tiIndex,nombre:o.nombreCTI,tipoN:o.tiposCTI[e].nombre,tipoI:o.tiposCTI[e].id,bd:"false"}),o.tiIndex++,o.nombreCTI="",o.tiposCTI.selected=0,o.form.$pristine=!0)},o.listadoEditar=function(e){for(var a=o.tiposItem.length-1;a>=0;a--)o.tiposItem[a].index===e&&(o.nombreCTI=o.tiposItem[a].nombre,o.tiposCTI.selected=o.tiposItem[a].tipoI,o.tiposItem.splice(a,1))},e.$on("eliminarLista",function(e,a){for(var t=o.tiposItem.length-1;t>=0;t--)o.tiposItem[t].index===a&&o.tiposItem.splice(t,1)})}]),angular.module("RDash").controller("gModulo",["$rootScope","$scope","$modal","$http","$location","$window",function(e,o,a,t,r,i){o.editar=!1,o.idM="",o.logueado=!1,o.verificarPrivilegio=function(){"undefined"!=typeof i.sessionStorage.gMod&&(o.logueado=i.sessionStorage.gMod),o.logueado||r.path("/Sesion")},o.porciento="",o.buscarPorciento=function(){o.porciento=30},o.buscarPorciento(),o.buscarModulos=function(){t.get("model/buscarGModulo.php").then(function(e){o.modulos=e.data})},o.buscarModulos(),o.moduloEditar=function(e){o.editar=!0;for(var a=o.modulos.length-1;a>=0;a--)if(o.modulos[a].id===e){o.nombreM=o.modulos[a].nombre,o.idM=o.modulos[a].id,o.codigoM=o.modulos[a].codigo,o.ofertaM=o.modulos[a].oferta,o.descripcionM=o.modulos[a].descripcion;var t=0;switch(o.modulos[a].area){case"Baño":t=1;break;case"Cocina":t=2;break;case"Comedor":t=3}o.area.selected=t,o.listado=[];for(var r=0,i=0,n=0,s="",l=o.modulos[a].items.length-1;l>=0;l--){var d=o.modulos[a].items[l].ancho,c=o.modulos[a].items[l].largo,p=o.modulos[a].items[l].cantidad,u=o.porciento,m=d*c;m>0?(i=parseFloat(m*p*o.modulos[a].items[l].compra).toFixed(3),s=" ("+d+" x "+c+")"):(i=parseFloat(p*o.modulos[a].items[l].compra).toFixed(3),s=""),n=parseFloat(parseFloat(i)*(u/100)+parseFloat(i)).toFixed(2),o.listado.push({index:r+"M",nombre:o.modulos[a].items[l].nombre+s,linea:0,cantidad:p,compraU:o.modulos[a].items[l].compra,ventaU:o.modulos[a].items[l].venta,compraT:i,ventaT:n,tipo:"item",id:o.modulos[a].items[l].id,ancho:d,largo:c}),r++}for(var l=o.modulos[a].modulos.length-1;l>=0;l--){var p=o.modulos[a].modulos[l].cantidad,u=o.porciento;i=parseFloat(p*o.modulos[a].modulos[l].compra).toFixed(3),n=parseFloat(parseFloat(i)*(u/100)+parseFloat(i)).toFixed(2),o.listado.push({index:r+"M",nombre:o.modulos[a].modulos[l].nombre,linea:0,cantidad:p,compraU:o.modulos[a].modulos[l].compra,ventaU:o.modulos[a].modulos[l].venta,compraT:i,ventaT:n,tipo:"modulo",id:o.modulos[a].modulos[l].id}),r++}break}},o.openModal=function(e,o,t){a.open({templateUrl:t,controller:"myModalController",size:e,resolve:{Items:function(){return o}}})},e.$on("modulo",function(e,a){t.post("model/eliminarModulo.php",a).success(function(e){"OK"===e?(o.openModal("sm","Eliminado correctamente el módulo.","ok.html"),o.buscarModulos(),o.editar=!1):o.openModal("sm",e,"error.html")})}),o.listado=[],o.errorP=!1,o.nombreM="",o.codigoM="",o.ofertaM="",o.descripcionM="",o.area=[{id:0,nombre:"--------"},{id:1,nombre:"Baño"},{id:2,nombre:"Cocina"},{id:3,nombre:"Comedor"}],o.area.selected=0,o.costo=function(){for(var e=0,a=o.listado.length-1;a>=0;a--)e+=parseFloat(o.listado[a].compraT);return parseFloat(e).toFixed(3)},o.venta=function(){for(var e=0,a=o.listado.length-1;a>=0;a--)e+=parseFloat(o.listado[a].ventaT);return parseFloat(e).toFixed(2)},o.oferta=function(){for(var e=0,a=o.listado.length-1;a>=0;a--)e+=parseFloat(o.listado[a].ofertaT);return parseFloat(e).toFixed(2)},o.actualizar=function(){o.errorListado=[],o.errorIndex=0;var e=!1,a=/^([a-zA-Z- -ñÑ])+$/,r=/^([a-zA-Z0-9])+$/,i=/^\d{0,9}(\.\d{1,2})?$/;if(""===o.nombreM?(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar un nombre para el módulo."}),o.errorIndex++):a.test(o.nombreM)||(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar un nombre válido para el módulo."}),o.errorIndex++),0===o.area[o.area.selected].id&&(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar el área a utilizar por el módulo."}),o.errorIndex++),""===o.codigoM?(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar un código para el módulo."}),o.errorIndex++):r.test(o.codigoM)||(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar un código válido para el módulo."}),o.errorIndex++),""===o.ofertaM?(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar un precio de oferta para el módulo."}),o.errorIndex++):i.test(o.ofertaM)||(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar un precio de oferta válido para el módulo."}),o.errorIndex++),""===o.descripcionM&&(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe especificar una descripción para el módulo."}),o.errorIndex++),0===o.listado.length&&(e=!0,o.errorListado.push({index:o.errorIndex,texto:"Debe ser escogido al menos un módulo o un item para utilizar en el módulo."}),o.errorIndex++),e)o.errorP=!0;else{o.errorP=!1;for(var n=[],s=o.listado.length-1;s>=0;s--){for(var l=!0,d=0;d<n.length;d++)if(n[d].id===o.listado[s].id&&n[d].tipo===o.listado[s].tipo){n[d].cantidad=parseInt(n[d].cantidad)+parseInt(o.listado[s].cantidad),l=!1;break}l&&n.push(o.listado[s])}var c={nombre:o.nombreM,codigo:o.codigoM,id:o.idM,area:o.area[o.area.selected].nombre,desc:o.descripcionM,oferta:o.ofertaM,listado:n,compra:o.costo(),venta:o.venta()};t.post("model/actualizarModulo.php",c).success(function(e){"OK"===e?(o.openModal("sm","Actualizado el módulo.","ok.html"),o.buscarModulos(),o.editar=!1):o.openModal("sm",e,"error.html")}).error(function(e){o.openModal("xs",e,"error.html")})}},e.$on("eliminarLista",function(e,a){for(var t=o.listado.length-1;t>=0;t--)o.listado[t].index===a&&o.listado.splice(t,1)})}]),angular.module("RDash").controller("gLinea",["$rootScope","$scope","$modal","$http","$location","$window",function(e,o,a,t,r,i){o.editar=!1,o.idL="",o.logueado=!1,o.verificarPrivilegio=function(){"undefined"!=typeof i.sessionStorage.gLin&&(o.logueado=i.sessionStorage.gLin),o.logueado||r.path("/Sesion")},o.buscarLineas=function(){var e=[{nombre:"Puerta",id:1,cantidad:3,compra:10,venta:15},{nombre:"Mano de Obra",id:2,cantidad:1,compra:20,venta:25}];o.lineas=[{nombre:"Linea Uno",id:1,descripcion:":Linea de prueba",codigo:"LIN1",compra:20,venta:25,items:e}],e=[{nombre:"Enganche",id:1,cantidad:6,compra:5,venta:8},{nombre:"Mano de Obra",id:2,cantidad:1,compra:10,venta:15}],o.lineas.push({nombre:"Linea Dos",id:2,descripcion:":Linea de prueba",codigo:"LIN2",compra:15,venta:20,items:e})},o.buscarLineas(),o.porciento="",o.buscarPorciento=function(){o.porciento=30},o.buscarPorciento(),o.lineaEditar=function(e){o.editar=!0;for(var a=o.lineas.length-1;a>=0;a--)if(o.lineas[a].id===e){o.nombreL=o.lineas[a].nombre,o.idL=o.lineas[a].id,o.codigoL=o.lineas[a].codigo,o.descripcionL=o.lineas[a].descripcion,o.listado=[];for(var t=0,r=o.lineas[a].items.length-1;r>=0;r--){var i=o.lineas[a].items[r].cantidad,n=o.porciento;compra=parseFloat(i*o.lineas[a].items[r].compra).toFixed(3),venta=parseFloat(parseFloat(compra)*(n/100)+parseFloat(compra)).toFixed(2),o.listado.push({index:t+"L",nombre:o.lineas[a].items[r].nombre,linea:0,cantidad:i,compraU:o.lineas[a].items[r].compra,ventaU:o.lineas[a].items[r].venta,compraT:compra,ventaT:venta,tipo:"item",id:o.lineas[a].items[r].id}),t++}break}},o.openModal=function(e,o,t){a.open({templateUrl:t,controller:"myModalController",size:e,resolve:{Items:function(){return o}}})},e.$on("linea",function(e,a){t.post("model/eliminarLinea.php",a).success(function(e){"OK"===e?(o.openModal("sm","Eliminada correctamente la línea.","ok.html"),o.buscarLineas(),o.editar=!1):o.openModal("sm",e,"error.html")})}),o.listado=[],o.actualizar=function(){for(var e=[],a=o.listado.length-1;a>=0;a--){for(var r=!0,i=0;i<e.length;i++)if(e[i].id===o.listado[a].id){e[i].cantidad=parseInt(e[i].cantidad)+parseInt(o.listado[a].cantidad),r=!1;break}r&&e.push(o.listado[a])}var n={id:o.idL,nombre:o.nombreL,codigo:o.codigoL,desc:o.descripcionL,listado:e,compra:o.costoL(),venta:o.ventaL()};t.post("model/actualizarLinea.php",n).success(function(e){"OK"===e?(o.openModal("sm","Actualizada correctamente la línea.","ok.html"),o.buscarLineas(),o.editar=!1):o.openModal("sm",e,"error.html")}).error(function(e){o.openModal("xs",e,"error.html")})},o.costoL=function(){for(var e=0,a=o.listado.length-1;a>=0;a--)e+=parseFloat(o.listado[a].compraT);return parseFloat(e).toFixed(3)},o.ventaL=function(){for(var e=0,a=o.listado.length-1;a>=0;a--)e+=parseFloat(o.listado[a].ventaT);return parseFloat(e).toFixed(2)},e.$on("eliminarLista",function(e,a){for(var t=o.listado.length-1;t>=0;t--)o.listado[t].index===a&&o.listado.splice(t,1)})}]),angular.module("RDash").controller("proforma",["$window","$scope","$http","$modal","$location","$stateParams","$state",function(e,o,a,t,r,i,n){o.activo=!1,o.Vcliente=!1,o.generar=!0,o.eliminar=!0,o.totalU=0,o.total=0,o.firma=0,o.instalacion=0,o.FPentrega=0,o.FP=0,o.selProy="",o.selProf="",o.listado=[],o.logueado=!1,o.verificarPrivilegio=function(){"undefined"!=typeof e.sessionStorage.Pro&&(o.logueado=e.sessionStorage.Pro),o.logueado||r.path("/Sesion")},o.$watch(function(){o.FP=parseInt(o.firma)+parseInt(o.instalacion)+parseInt(o.FPentrega)}),o.selectProf=function(e){o.activo=!0,o.numero=e.data.numero,o.fecha=e.data.fecha,o.eliminar=!1,o.generar=!0,o.listado=[],o.selProf=e.data.id,o.proyecto="1, Proyecto1",o.entrega=30,o.totalU=50,o.total=100,o.firma=30,o.instalacion=60,o.FPentrega=10;var a=[{id:1,idI:1,codigo:"IT1",desc:"Item1",compra:10,cantidad:1,total:10}],t=[{idM:1,nombre:"Modulo1",linea:"Linea1",cant:2,items:a,totalU:20,total:40},{idM:2,nombre:"Modulo2",linea:"Linea1",cant:2,items:a,totalU:30,total:60}],r=[{area:"Cocina",modulos:t,totalU:50,total:100}],i=[{nombre:"Linea1",desc:"Ejemplo Linea 1"}];o.listado.push(r),o.listado.push(i)},o.selectProy=function(e){o.activo=!1,o.Vcliente=!1,o.eliminar=!0,o.generar=!1,o.selProy=e.data.id},o.selectRaiz=function(){o.activo=!1,o.eliminar=!0,o.generar=!0,o.Vcliente=!1,o.selProy="",o.selProf=""},o.generarProf=function(){a.post("model/generarProforma.php",o.selProy).success(function(e){"OK"===e?(o.openModal("sm","Generada correctamente la proforma.","ok.html"),i.page=1,n.reload()):o.openModal("sm",e,"error.html")}).error(function(e){o.openModal("xs",e,"error.html")})},o.eliminarProf=function(){a.post("model/eliminarProforma.php",o.selProf).success(function(e){"OK"===e?(o.openModal("sm","Eliminada la proforma.","ok.html"),i.page=1,n.reload()):o.openModal("sm",e,"error.html")}).error(function(e){o.openModal("xs",e,"error.html")})},o.actualizarFP=function(){var e={idP:o.selProf,firma:o.firma,instalacion:o.instalacion,entrega:o.FPentrega};a.post("model/actualizarProforma.php",e).success(function(e){"OK"===e?(o.openModal("sm","Actualizada la forma de pago.","ok.html"),i.page=1,n.reload()):o.openModal("sm",e,"error.html")}).error(function(e){o.openModal("xs",e,"error.html")})},o.openModal=function(e,o,a){t.open({templateUrl:a,controller:"myModalController",size:e,resolve:{Items:function(){return o}}})},o.imprimirPdf=function(e){var a;a="true"===e?o.PdfCliente():o.PdfAdmin(),pdfMake.createPdf(a).download()},o.PdfAdmin=function(){for(var e=[],a=0;a<o.listado[0].length;a++){e.push([{text:"Área: "+o.listado[0][a].area.toString(),style:"filaModulo",colSpan:5},{},{},{},{}]);var t=new Array({text:"Módulo",style:"tableHeader"},{text:"Línea",style:"tableHeader"},{text:"Cantidad",style:"tableHeader"},{text:"Valor U.",style:"tableHeader"},{text:"Total USD",style:"tableHeader"});e.push(t);for(var r=0;r<o.listado[0][a].modulos.length;r++){var i=new Array;i.push(o.listado[0][a].modulos[r].nombre),i.push({text:o.listado[0][a].modulos[r].linea.toString(),style:"colCentro"}),i.push({text:o.listado[0][a].modulos[r].cant.toString(),style:"colCentro"}),i.push({text:o.listado[0][a].modulos[r].totalU.toString(),style:"colDerecha"}),i.push({text:o.listado[0][a].modulos[r].total.toString(),style:"colDerecha"}),e.push(i)}e.push([{text:"Total del Área: "+o.listado[0][a].area.toString(),style:"filaModulo",colSpan:3,alignment:"right"},{},{},{text:o.listado[0][a].totalU.toString(),style:"filaModuloDerecha"},{text:o.listado[0][a].total.toString(),style:"filaModuloDerecha"}])}e.push([{text:"Total del Proyecto:",style:"filaModulo",alignment:"right",colSpan:4},{},{},{},{text:o.total.toString(),style:"filaModulo",alignment:"right"}]);for(var n=[],a=0;a<o.listado[1].length;a++)n=0===a?[{text:"CARACTERISTICAS LÍNEA "+o.listado[1][a].nombre,bold:!0,fontSize:10}]:[n[0],{text:"CARACTERISTICAS LÍNEA "+o.listado[1][a].nombre,style:"subheader"}],n=[n[0],{text:o.listado[1][a].desc,fontSize:10}];return docDefinition={content:[{style:"header",text:"PROFORMA No. "+o.numero},{style:"subheader",text:[{text:"Cliente:",bold:!0}," SEÑOR(A) "+o.cliente]},{style:"subheader",text:[{text:"Fecha:",bold:!0}," "+o.fecha]},{style:"subheader",text:[{text:"Proyecto:",bold:!0}," "+o.proyecto]},{style:"subheader",text:""},{style:"subheader",text:"Nos es grato poner a su consideración nuestros productos de excelente calidad y con precios muy competitivos en el mercado."},{style:"subheader",text:"Esperamos cumplir con sus expectativas y tener una respuesta favorable."},{style:"subheader",text:""},{style:"subheader",text:""},{style:"demoTable",table:{headerRows:0,widths:["*","*","*","*","*","*"],body:e}},{style:"subheader",text:""},{style:"subheader",text:""},n,{style:"subheader",text:""},{style:"subheader",text:""},{style:"subheader",text:[{text:"TIEMPO DE ENTREGA:",bold:!0}," "+o.entrega+" días"]},{style:"subheader",text:""},{style:"subheader",text:""},{style:"subheader",text:[{text:"FORMA DE PAGO:",bold:!0}]},{style:"subheader",text:[o.firma.toString()+" %  A LA FIRMA DEL CONTRATO"]},{style:"subheader",text:[o.instalacion.toString()+" %  A LA INSTALACIÓN DE LOS MUEBLES"]},{style:"subheader",text:[o.FPentrega.toString()+" %  CONTRA ENTREGA"]}],styles:{header:{bold:!0,color:"#000",fontSize:11,alignment:"center",margin:20},subheader:{color:"#000",fontSize:11,margin:5},demoTable:{color:"#666",fontSize:10},totalTable:{fontSize:10,alignment:"right"},tableHeader:{bold:!0,color:"black",alignment:"center",fillColor:"#EEEAE9"},filaModulo:{bold:!0,color:"black",fillColor:"#F7F7F7"},filaModuloCentro:{bold:!0,color:"black",alignment:"center",fillColor:"#F7F7F7"},filaModuloDerecha:{bold:!0,color:"black",alignment:"right",fillColor:"#F7F7F7"},colCentro:{alignment:"center"},colDerecha:{alignment:"right"},colIzquierda:{alignment:"right"}}}},o.PdfCliente=function(){for(var e=[],a=0;a<o.listado[0].length;a++){e.push([{text:"Área: "+o.listado[0][a].area.toString(),style:"filaModulo",colSpan:3},{},{}]);var t=new Array({text:"Módulo",style:"tableHeader"},{text:"Línea",style:"tableHeader"},{text:"Cantidad",style:"tableHeader"});e.push(t);for(var r=0;r<o.listado[0][a].modulos.length;r++){var i=new Array;i.push(o.listado[0][a].modulos[r].nombre),i.push({text:o.listado[0][a].modulos[r].linea.toString(),style:"colCentro"}),i.push({text:o.listado[0][a].modulos[r].cant.toString(),style:"colCentro"}),e.push(i)}}e.push([{text:"Total del Proyecto:",style:"filaModulo",alignment:"right",colSpan:2},{},{text:o.total.toString(),style:"filaModulo",alignment:"center"}]);for(var n=[],a=0;a<o.listado[1].length;a++)n=0===a?[{text:"CARACTERISTICAS LÍNEA "+o.listado[1][a].nombre,bold:!0,fontSize:10}]:[n[0],{text:"CARACTERISTICAS LÍNEA "+o.listado[1][a].nombre,style:"subheader"}],n=[n[0],{text:o.listado[1][a].desc,fontSize:10}];return docDefinition={content:[{style:"header",text:"PROFORMA No. "+o.numero},{style:"subheader",text:[{text:"Cliente:",bold:!0}," SEÑOR(A) "+o.cliente]},{style:"subheader",text:[{text:"Fecha:",bold:!0}," "+o.fecha]},{style:"subheader",text:[{text:"Proyecto:",bold:!0}," "+o.proyecto]},{style:"subheader",text:""},{style:"subheader",text:"Nos es grato poner a su consideración nuestros productos de excelente calidad y con precios muy competitivos en el mercado."},{style:"subheader",text:"Esperamos cumplir con sus expectativas y tener una respuesta favorable."},{style:"subheader",text:""},{style:"subheader",text:""},{style:"demoTable",table:{headerRows:0,widths:["*","*","*"],body:e}},{style:"subheader",text:""},{style:"subheader",text:""},n,{style:"subheader",text:""},{style:"subheader",text:""},{style:"subheader",text:[{text:"TIEMPO DE ENTREGA:",bold:!0}," "+o.entrega+" días"]},{style:"subheader",text:""},{style:"subheader",text:""},{style:"subheader",text:[{text:"FORMA DE PAGO:",bold:!0}]},{style:"subheader",text:[o.firma.toString()+" %  A LA FIRMA DEL CONTRATO"]},{style:"subheader",text:[o.instalacion.toString()+" %  A LA INSTALACIÓN DE LOS MUEBLES"]},{style:"subheader",text:[o.FPentrega.toString()+" %  CONTRA ENTREGA"]}],styles:{header:{bold:!0,color:"#000",fontSize:11,alignment:"center",margin:20},subheader:{color:"#000",fontSize:11,margin:5},demoTable:{color:"#666",fontSize:10},totalTable:{fontSize:10,alignment:"right"},tableHeader:{bold:!0,color:"black",alignment:"center",fillColor:"#EEEAE9"},filaModulo:{bold:!0,color:"black",fillColor:"#F7F7F7"},filaModuloCentro:{bold:!0,color:"black",alignment:"center",fillColor:"#F7F7F7"},filaModuloDerecha:{bold:!0,color:"black",alignment:"right",fillColor:"#F7F7F7"},colCentro:{alignment:"center"},colDerecha:{alignment:"right"},colIzquierda:{alignment:"right"}}}}}]),angular.module("RDash").controller("facturar",["$window","$scope","$http","$modal","$location","$stateParams","$state",function(e,o,a,t,r,i,n){o.facturar=!0,o.selProy="",o.selProf="",o.logueado=!1,o.verificarPrivilegio=function(){"undefined"!=typeof e.sessionStorage.Fac&&(o.logueado=e.sessionStorage.Fac),o.logueado||r.path("/Sesion")},o.selectProf=function(e){o.facturar=!1,o.selProf=e.data.id},o.selectProy=function(e){o.facturar=!0,o.selProy=e.data.id},o.selectRaiz=function(){o.facturar=!0,o.selProy="",o.selProf=""},o.facturarProyecto=function(){a.post("model/facturarProyecto.php",o.selProf).success(function(e){"OK"===e?(o.openModal("sm","Factura generada correctamente.","ok.html"),i.page=1,n.reload()):o.openModal("sm",e,"error.html")}).error(function(e){o.openModal("xs",e,"error.html")})},o.openModal=function(e,o,a){t.open({templateUrl:a,controller:"myModalController",size:e,resolve:{Items:function(){return o}}})}}]),angular.module("RDash").controller("vfactura",["$window","$scope","$http","$modal","$location","$stateParams","$state",function(e,o,a,t,r,i,n){o.activo=!1,o.selProy="",o.fecha="",o.cliente="",o.ruc="",o.dir="",o.telef="",o.correo="",o.subtotal=0,o.descuento=0,o.tarifa=0,o.total=0,o.letrasTotal="Cero Dólares",o.numero="",o.vfac="",o.listado=[],o.logueado=!1,o.verificarPrivilegio=function(){"undefined"!=typeof e.sessionStorage.vFac&&(o.logueado=e.sessionStorage.vFac),o.logueado||r.path("/Sesion")},o.$watch(function(){porciento=parseFloat(parseFloat(o.subtotal)*parseFloat(o.tarifa)/100).toFixed(2),o.total=parseFloat(parseFloat(o.subtotal)-parseFloat(o.descuento)+parseFloat(porciento)).toFixed(2)}),o.$watch(function(){o.total>-1?o.letrasTotal=o.NumeroALetras(o.total):o.letrasTotal="Menos "+o.NumeroALetras(-1*o.total)}),o.selectFact=function(e){o.activo=!0,o.selProy=e.data.id,o.fecha=e.data.fecha,o.cliente=e.data.nombre,o.ruc=e.data.ruc,o.dir=e.data.dir,o.telef=e.data.telef,o.correo=e.data.correo,o.subtotal=e.data.total,o.descuento=e.data.descuento,o.tarifa=e.data.tarifa,o.numero=e.data.num,o.listado=[],o.listado.push(e.data.modulos);var a=parseFloat(parseFloat(o.subtotal)*parseFloat(o.tarifa)/100).toFixed(2),t=parseFloat(parseFloat(o.subtotal)-parseFloat(o.descuento)+parseFloat(a)).toFixed(2);o.letrasTotal=o.NumeroALetras(t)},o.selectRaiz=function(){o.activo=!1,o.selProy="",o.fecha="",o.cliente="",o.ruc="",o.dir="",o.telef="",o.correo="",o.subtotal=0,o.descuento=0,o.tarifa=0,o.total=0,o.listado=[]},o.actualizarFact=function(){var e={idF:o.selProy,descuento:o.descuento,tarifa:o.tarifa};a.post("model/actualizarFactura.php",e).success(function(e){"OK"===e?(o.openModal("sm","Actualizada la factura.","ok.html"),i.page=1,n.reload()):o.openModal("sm",e,"error.html")}).error(function(e){o.openModal("xs",e,"error.html")})},o.openModal=function(e,o,a){t.open({templateUrl:a,controller:"myModalController",size:e,resolve:{Items:function(){return o}}})},o.imprimirPdf=function(){var e=o.PdfBody();pdfMake.createPdf(e).download()},o.PdfBody=function(){var e=[],a=new Array({text:"Cantidad",style:"tableHeader"},{text:"Concepto",style:"tableHeader"},{text:"Valor Unitario",style:"tableHeader"},{text:"Valor Total",style:"tableHeader"});e.push(a);for(var t=0;t<o.listado[0].length;t++){var r=new Array;r.push({text:o.listado[0][t].cantidad.toString(),style:"colCentro"}),r.push(o.listado[0][t].concepto),r.push({text:o.listado[0][t].unitario.toString(),style:"colDerecha"}),r.push({text:o.listado[0][t].total.toString(),style:"colDerecha"}),e.push(r)}return docDefinition={content:[{style:"header",text:"FACTURA "+o.numero},{style:"subheader",text:[{text:"Fecha:",bold:!0}," "+o.fecha]},{style:"subheader",text:[{text:"Cliente:",bold:!0}," SEÑOR(A) "+o.cliente]},{style:"subheader",text:[{text:"RUC/CC:",bold:!0}," "+o.ruc]},{style:"subheader",text:[{text:"Dirección:",bold:!0}," "+o.dir]},{style:"subheader",text:[{text:"E-mail:",bold:!0}," "+o.correo]},{style:"subheader",text:[{text:"Teléfono:",bold:!0}," "+o.telef]},{style:"subheader",text:""},{style:"subheader",text:""},{style:"demoTable",table:{headerRows:1,widths:["*","*","*","*"],body:e}},{style:"subheader",text:""},{style:"subheader",text:""},{style:"subheader",text:[{text:"SON:",bold:!0}," "+o.letrasTotal]},{style:"subheader",text:""},{style:"subheader",text:""},{style:"totalTable",table:{headerRows:0,widths:["15%","20%"],body:[[{text:"Subtotal: ",bold:!0},o.subtotal.toString()],[{text:"Descuento: ",bold:!0},o.descuento.toString()],[{text:"Tarifa 0% IVA: ",bold:!0},o.tarifa.toString()],[{text:"Total: ",bold:!0},o.total.toString()]]}}],styles:{header:{bold:!0,color:"#000",fontSize:11,alignment:"center",margin:20},subheader:{color:"#000",fontSize:11,margin:5},demoTable:{color:"#666",fontSize:10},totalTable:{fontSize:10,alignment:"right"},tableHeader:{bold:!0,color:"black",alignment:"center",fillColor:"#EEEAE9"},colCentro:{alignment:"center"},colDerecha:{alignment:"right"},colIzquierda:{alignment:"right"}}}},o.Unidades=function(e){switch(e){case 1:return"Un";case 2:return"Dos";case 3:return"Tres";case 4:return"Cuatro";case 5:return"Cinco";case 6:return"Seis";case 7:return"Siete";case 8:return"Ocho";case 9:return"Nueve"}return""},o.Decenas=function(e){var a=Math.floor(e/10),t=e-10*a;switch(a){case 1:switch(t){case 0:return"Diez";case 1:return"Once";case 2:return"Doce";case 3:return"Trece";case 4:return"Catorce";case 5:return"Quince";default:return"Dieci"+o.Unidades(t)}case 2:switch(t){case 0:return"Veinte";default:return"Venti"+o.Unidades(t)}case 3:return o.DecenasY("Treinta",t);case 4:return o.DecenasY("Cuarenta",t);case 5:return o.DecenasY("Cincuenta",t);case 6:return o.DecenasY("Sesenta",t);case 7:return o.DecenasY("Setenta",t);case 8:return o.DecenasY("Ochenta",t);case 9:return o.DecenasY("Noventa",t);case 0:return o.Unidades(t)}return""},o.DecenasY=function(e,a){return a>0?e+" Y "+o.Unidades(a):e},o.Centenas=function(e){var a=Math.floor(e/100),t=e-100*a;switch(a){case 1:return t>0?"Ciento "+o.Decenas(t):"Cien";case 2:return"Doscientos "+o.Decenas(t);case 3:return"Trescientos "+o.Decenas(t);case 4:return"Cuatrocientos "+o.Decenas(t);case 5:return"Quinientos "+o.Decenas(t);case 6:return"Seiscientos "+o.Decenas(t);case 7:return"Setecientos "+o.Decenas(t);case 8:return"Ochocientos "+o.Decenas(t);case 9:return"Novecientos "+o.Decenas(t)}return o.Decenas(t)},o.Seccion=function(e,a,t,r){var i=Math.floor(e/a),n=e-i*a,s="";return i>0&&(s=i>1?o.Centenas(i)+" "+r:t),n>0&&(s+=""),s},o.Miles=function(e){var a=1e3,t=Math.floor(e/a),r=e-t*a,i=o.Seccion(e,a,"Un Mil","Mil"),n=o.Centenas(r);return""===i?n:i+" "+n},o.Millones=function(e){var a=1e6,t=Math.floor(e/a),r=e-t*a,i=o.Seccion(e,a,"Un Millón de ","Millones de "),n=o.Miles(r);return""===i?n:i+" "+n},o.NumeroALetras=function(e){var a={numero:e,enteros:Math.floor(e),centavos:Math.round(100*e)-100*Math.floor(e),letrasCentavos:"",letrasMonedaPlural:"Dólares",letrasMonedaSingular:"Dólar",letrasMonedaCentavoPlural:"Centavos",letrasMonedaCentavoSingular:"Centavo"};return a.centavos>0&&(a.letrasCentavos="Con "+function(){return 1===a.centavos?o.Millones(a.centavos)+" "+a.letrasMonedaCentavoSingular:o.Millones(a.centavos)+" "+a.letrasMonedaCentavoPlural}()),0===a.enteros?"Cero "+a.letrasMonedaPlural+" "+a.letrasCentavos:1===a.enteros?o.Millones(a.enteros)+" "+a.letrasMonedaSingular+" "+a.letrasCentavos:o.Millones(a.enteros)+" "+a.letrasMonedaPlural+" "+a.letrasCentavos}}]),angular.module("RDash").controller("Perfil",["$scope","$modal","$http","$location","$window",function(e,o,a,t,r){e.nombreU=r.sessionStorage.nameUser,e.descripcionU=r.sessionStorage.descUser,e.passU="",e.passRepU="",e.rol=r.sessionStorage.nameRolUser,e.nombreActualizar=r.sessionStorage.nameUser,e.logueado=!1,e.verificarPrivilegio=function(){"undefined"!=typeof r.sessionStorage.mPer&&(e.logueado=r.sessionStorage.mPer),e.logueado||t.path("/Sesion")},e.porciento="",e.idRolUser=r.sessionStorage.idRolUser,e.buscarPorciento=function(){e.porciento=30},e.buscarPorciento(),e.actualizarPorciento=function(){var o={porciento:e.porciento};a.post("model/actualizarPorciento.php",o).success(function(o){"OK"===o?e.openModal("sm","Actualizado correctamente el porcentaje.","ok.html"):e.openModal("sm",o,"error.html");
}).error(function(o){e.openModal("xs",o,"error.html")})},e.guardar=function(){var o={id:e.nombreActualizar,nombre:e.nombreU,password:e.passU,desc:e.descripcionU,idRol:r.sessionStorage.idRolUser};a.post("model/actualizarUsuario.php",o).success(function(o){"OK"===o?(e.openModal("sm","Actualizado correctamente su perfil.","ok.html"),r.sessionStorage.nameUser=e.nombreU,r.sessionStorage.descUser=e.descripcionU,""!==e.passU&&(r.sessionStorage.passUser=e.passU),e.passU="",e.passRepU="",e.nombreActualizar=r.sessionStorage.nameUser):e.openModal("sm",o,"error.html")}).error(function(o){e.openModal("xs",o,"error.html")})},e.openModal=function(e,a,t){o.open({templateUrl:t,controller:"myModalController",size:e,resolve:{Items:function(){return a}}})}}]),angular.module("RDash").controller("inicio",["$scope","$http","$window","$rootScope",function(e,o,a,t){e.proyectos=[],t.nProy=a.sessionStorage.nProy,t.gProy=a.sessionStorage.gProy,t.nLin=a.sessionStorage.nLin,t.gLin=a.sessionStorage.gLin,t.nIt=a.sessionStorage.nIt,t.gIt=a.sessionStorage.gIt,t.nTIt=a.sessionStorage.nTIt,t.gTIt=a.sessionStorage.gTIt,t.nMod=a.sessionStorage.nMod,t.gMod=a.sessionStorage.gMod,t.Pro=a.sessionStorage.Pro,t.Fac=a.sessionStorage.Fac,t.vFac=a.sessionStorage.vFac,t.mPer=a.sessionStorage.mPer,t.gNot=a.sessionStorage.gNot,t.gUs=a.sessionStorage.gUs,t.gRol=a.sessionStorage.gRol,t.nameUser=a.sessionStorage.nameUser,t.hayNotif=!1,e.buscarProyectos=function(){o.get("model/buscarGProyectos.php").then(function(o){e.proyectos=o.data})},e.buscarProyectos(),e.buscarNotif=function(){o.get("model/buscarNotif.php?id="+a.sessionStorage.nameUser).then(function(e){e.data.length>0&&(t.hayNotif=!0)})},e.buscarNotif()}]);
"use strict";angular.module("RDash").config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/error"),t.state("index",{url:"",templateUrl:"templates/Sesion.html"}).state("error",{url:"/error",templateUrl:"templates/inicio.html"}).state("Sesion",{url:"/Sesion",templateUrl:"templates/Sesion.html"}).state("Usuarios",{url:"/Usuarios",templateUrl:"templates/Usuarios.html"}).state("Roles",{url:"/Roles",templateUrl:"templates/Roles.html"}).state("inicio",{url:"/inicio",templateUrl:"templates/inicio.html"}).state("nProyecto",{url:"/nProyecto",templateUrl:"templates/nProyecto.html"}).state("gProyecto",{url:"/gProyecto",templateUrl:"templates/gProyecto.html"}).state("Linea",{url:"/Linea",templateUrl:"templates/Linea.html"}).state("gLinea",{url:"/gLinea",templateUrl:"templates/gLinea.html"}).state("nItem",{url:"/nItem",templateUrl:"templates/nItem.html"}).state("gItem",{url:"/gItem",templateUrl:"templates/gItem.html"}).state("nTipoItem",{url:"/nTipoItem",templateUrl:"templates/nTipoItem.html"}).state("gTipoItem",{url:"/gTipoItem",templateUrl:"templates/gTipoItem.html"}).state("nModulo",{url:"/nModulo",templateUrl:"templates/nModulo.html"}).state("gModulo",{url:"/gModulo",templateUrl:"templates/gModulo.html"}).state("Proforma",{url:"/Proforma",templateUrl:"templates/Proforma.html"}).state("Facturar",{url:"/Facturar",templateUrl:"templates/Facturar.html"}).state("Notificaciones",{url:"/Notificaciones",templateUrl:"templates/Notificaciones.html"}).state("Perfil",{url:"/Perfil",templateUrl:"templates/Perfil.html"}).state("vFactura",{url:"/vFactura",templateUrl:"templates/vFactura.html"})}]);
function AlertsCtrl(e){e.alerts=[{type:"success",msg:"Thanks for visiting! Feel free to create pull requests to improve the dashboard!"},{type:"danger",msg:"Found a bug? Create an issue with as many details as you can."}],e.addAlert=function(){e.alerts.push({msg:"Another alert!"})},e.closeAlert=function(t){e.alerts.splice(t,1)}}angular.module("RDash").controller("AlertsCtrl",["$scope",AlertsCtrl]);
function MasterCtrl(t,e){var g=992;t.getWidth=function(){return window.innerWidth},t.$watch(t.getWidth,function(o,n){o>=g?angular.isDefined(e.get("toggle"))?t.toggle=e.get("toggle")?!0:!1:t.toggle=!0:t.toggle=!1}),t.toggleSidebar=function(){t.toggle=!t.toggle,e.put("toggle",t.toggle)},window.onresize=function(){t.$apply()}}angular.module("RDash").controller("MasterCtrl",["$scope","$cookieStore",MasterCtrl]);
function rdLoading(){var d={restrict:"AE",template:'<div class="loading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>'};return d}angular.module("RDash").directive("rdLoading",rdLoading);
function rdWidgetBody(){var d={requires:"^rdWidget",scope:{loading:"@?",classes:"@?"},transclude:!0,template:'<div class="widget-body" ng-class="classes"><rd-loading ng-show="loading"></rd-loading><div ng-hide="loading" class="widget-content" ng-transclude></div></div>',restrict:"E"};return d}angular.module("RDash").directive("rdWidgetBody",rdWidgetBody);
function rdWidgetFooter(){var e={requires:"^rdWidget",transclude:!0,template:'<div class="widget-footer" ng-transclude></div>',restrict:"E"};return e}angular.module("RDash").directive("rdWidgetFooter",rdWidgetFooter);
function rdWidgetTitle(){var i={requires:"^rdWidget",scope:{title:"@",icon:"@"},transclude:!0,template:'<div class="widget-header"><div class="row"><div class="pull-left"><i class="fa" ng-class="icon"></i> {{title}} </div><div class="pull-right col-xs-6 col-sm-4" ng-transclude></div></div></div>',restrict:"E"};return i}angular.module("RDash").directive("rdWidgetHeader",rdWidgetTitle);
function rdWidget(){var d={transclude:!0,template:'<div class="widget" ng-transclude></div>',restrict:"EA"};return d}angular.module("RDash").directive("rdWidget",rdWidget);